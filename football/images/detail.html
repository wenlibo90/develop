<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=750px,user-scalable=no">
<title>Russia世界杯</title>
<link rel="stylesheet" href="css/style.css"/>
<style>
body{
	background:#f2f2f2
}
.box{
	background:url(images/3-page.jpg) no-repeat;
}
    .tips{
        position: fixed;
        z-index: 12;
        bottom: 0;
        top: 0;
        left: 0;
        width: 100%;
        display: none;
        background-color: rgba(0,0,0,.55);
    }
    .tipBox{
        position: relative;
        top: 300px;
        left: 50%;
        transform: translate(-50%);
        width: 535px;
        height: 250px;

        overflow: hidden;
        background: url(images/tips.png) no-repeat top center ;
    }
    .tips .close{
        display: block;
        position: absolute;
        top: 0;
        right:30px;
    }
    .tips .pDiv{
        font-size: 24px;
        width: 315px;
        color: #323232;
        margin: 100px 0 0 55px;
        overflow: hidden;
        line-height: 40px;
    }

</style>
</head>

<body>
<div class="loginBox">
    <div class="login">
        <span class="close">&times;</span>
        <p class="tit">登录</p>
        <p class="t-cont">
            <input type="text" placeholder="请输入您的姓名" id="uName">
        </p>
        <p class="t-cont">
            <input type="number" placeholder="请输入您的手机号" id="uCall" maxlength="11">
            <span class="yzm">获取验证码</span>
        </p>
        <p class="t-cont">
            <input type="number" placeholder="请输入验证码" id="uCode" maxlength="6">
        </p>
        <a href="javascript:void(0)" class="loginBtn">确认并提交</a>
    </div>
</div>
<div class="msg"></div>
<!--吃球球 动画-->
<div class="loadBox">
    <div class="loader">
        <div class="loader-inner pacman">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    服务请求中，请稍后
</div>
<div class="box">
	<div class="record"></div>
    <div class="endtime">净胜球差：俄罗斯让1球</div>
    <div class="animationDiv">

    </div>
    <!--<div class="handcup">盘口：阿根廷 平手/半球 冰岛</div>-->
    <div class="rtk"><marquee direction=left>竞猜赢大奖</marquee></div>
    
    <div class="grass">
    	<div class="grass-t"><i><img src="images/timg-16.png" width="130" height="130" /></i><span>葡萄牙</span><i class="n-right"><img src="images/timg-17.png" width="130" height="130" /></i><span class="n-right">西班牙</span></div>
        <ul class="grass-type">
            <li class="on">专家</li><li>职业</li><li>业余</li><span>（选择玩家级别）</span>
        </ul>
        <div class="guss-box">
        	<ul class="guss-win">
            	<h2><i></i>请选择胜／负／平</h2>
                <li class="on">胜</li>
                <li>负</li>
                <li>平</li>
            </ul>
            
            <ul class="guss-ball">
            	<h2><i></i>请选择大小球</h2>
                <li class="on">大</li>
                <li>小</li>
            </ul>

            <div class="guss-score">
            	<div class="score-team"><i><img src="images/timg-16.png" width="67" height="67" /></i><span>葡萄牙</span><i class="n-right"><img src="images/timg-17.png" width="67" height="67" /></i><span class="n-right">西班牙</span></div>
                <div class="score-input">
                    <input type="number" placeholder="请输入比分" id="userHomeTeamResultScore" min="0"/><span>:</span>
                    <input type="number" placeholder="请输入比分" id="userGuestTeamResultScore" min="0"/>
                </div>
            </div>
        	
        </div>
    </div>
    
    <div class="d rule">
    	<h2>竞猜规则</h2>
        <ul>
          <li>业余级：单场竞猜胜、平、负，竞猜结果与实际比赛结果一致（均以90分钟比赛结果为准）</li>
          <li>职业级：参照业余级竞猜规则，同时猜对竞猜场次大、小球，3球含3球算小球，4球含4球算大球<br/><span>注：如客户猜对胜负关系赠送40%；猜对大小球赠送20%；全部竞猜正确赠送60%</span></li>
          <li>专家级：参照业余级、职业级竞猜规则，同时猜对竞猜场次比分；<br/><span>注：如客户猜对胜负关系赠送40%；猜对大小球赠送20%；猜中比分赠送40%；全部竞猜正确赠送100%</span></li>
          <li>线上购买参与时间：9:00—18:00</li>
        </ul>
    </div>
    <div class="submitBtn"><a href="javascript:void(0)">立即竞猜</a></div>
</div>
<div class="tips">
    <div class="tipBox">
        <img src="images/tipsCloseBtn.png" class="close">
       <div class="pDiv">
           <p>俄罗斯本场比赛</p>
           <p>净胜球2球（含）以上，为胜</p>
       </div>
    </div>
</div>
<script type="text/javascript" src="http://static.yuntongauto.com/js/jquery-1.9.1.min.js"></script>
<script src="http://static.yuntongauto.com/js/cookie.js" type="text/javascript"></script>
<script src="js/base.js"></script>
<script>
$(function(){
    init();
    var plate=0;
    function init() {
        setAjax('/footballGameGuess/selectPayManDesc',{},userShow)
        if(!getUrlParam().id){
            $(".msg").html('获取不到场次id').stop().slideDown().delay(2000).slideUp()
        }else{
            var data={
                id:getUrlParam().id
            }

            setAjax('/footballGame/getGameById',data,function (data) {
                console.log(data)
                if(data.success){

                    $('.endtime').html('净胜球差：'+data.result.homeTeam+'让'+data.result.guestTeam+''+data.result.plate+'球')
                    plate=data.result.plate;
                    $('.pDiv').html('<p>'+data.result.homeTeam+'本场比赛</p>\n' +
                            '        <p>净胜球'+(data.result.plate+1)+'球（含）以上，为胜</p>')
                    //$('.endtime').html('竞猜截止时间: '+timeFormat(data.result.gameTime).slice(5,-3))
                    $('.score-team').html('<i><img src="'+data.result.homePicture+'" width="67" height="67" /></i><span>'+data.result.homeTeam+'</span><i class="n-right"><img src="'+data.result.guestPicture+'" width="67" height="67" /></i><span class="n-right">'+data.result.guestTeam+'</span>')
                    $('.grass-t').html('<i><img src="'+data.result.homePicture+'" width="130" height="130" /></i><span>'+data.result.homeTeam+'</span><i class="n-right"><img src="'+data.result.guestPicture+'" width="130" height="130" /></i><span class="n-right">'+data.result.guestTeam+'</span>')
                }else{
                    $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
                }
            })
        }
    }
    function userShow(data) {
        if(data.success){
            var str='';
            $.each(data.result,function (i,v) {
                str += '<span style="padding-right: 120px">'+v+'</span>'
            })
            $('marquee').html(str)
        }else{
            $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
        }
    }
	$(".guss-box ul li").click(function() {
		$(this).addClass("on").siblings("li").removeClass("on"); 
	})
    $('.guss-win li').click(function () {
        $('.tips').show();
    })

    $(".grass-type li").click(function() {
		$(this).addClass("on").siblings("li").removeClass("on"); 
        var txt=$(this).html();
        if(txt=='业余'){
            $('.guss-ball').hide()
        }else{
            $('.guss-ball').show()
        }
    })

    $('.submitBtn a').click(function () {
        var gameId=getUrlParam().id;
        var userHomeTeamResultScore=$('#userHomeTeamResultScore').val();
        var userGuestTeamResultScore=$('#userGuestTeamResultScore').val();
       console.log(userGuestTeamResultScore +userHomeTeamResultScore)
        if(!gameId){
            $(".msg").html('未获取到场次id').stop().slideDown().delay(2000).slideUp()
        }else if(!userHomeTeamResultScore || !userGuestTeamResultScore){
            $(".msg").html('请输入比分').stop().slideDown().delay(2000).slideUp()
        }else{
            var userGuessBigSmall=$('.guss-ball li.on').html();
            var level=$('.grass-type li.on').html();
            if(level=='业余'){
                userGuessBigSmall=null;
            }
            var gassWin=$('.guss-win li.on').html()
            var userId=cookie.getCookie('userId')
            var userGuessSuccessFalse=$('.guss-win li.on').html();
            if(userId){
                var data={
                    gameId:gameId,
                    userId:userId,
                    token:cookie.getCookie('token'),
                    level:level,
                    appId:sessionStorage.getItem('appId'),
                    userGuessBigSmall:userGuessBigSmall,
                    userGuessSuccessFalse:userGuessSuccessFalse,
                    userHomeTeamResultScore:userHomeTeamResultScore,
                    userGuestTeamResultScore:userGuestTeamResultScore
                }
                console.log(data)
                if(isTureSuccessFlase(userGuessSuccessFalse,userHomeTeamResultScore,userGuestTeamResultScore).flag){
                    setAjax('/footballGameGuess/saveFootballGameGuess',data,function (data) {
                        console.log(data)
                        if(data.success){
                            //跳转到服务端支付页面
                            window.location.href=data.result;
                            //window.location.href=basePath+'/pay/goToPay?guessId=112&userId=3152898250778628';
                        }else{
                           if(data.code=='0'){
                               $('.loginBox').show();
                           }else{
                               $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
                           }
                        }
                    })
                }
            }else{
                $('.loginBox').show();
            }
        }

    })
    function isTureSuccessFlase(userGuessSuccessFalse,userHomeTeamResultScore,userGuestTeamResultScore) {
        var flag=true;
        var msg=null;
        userHomeTeamResultScore=Number(userHomeTeamResultScore)
        userGuestTeamResultScore=Number(userGuestTeamResultScore)
        plate=Number(plate)?Number(plate):0;

        switch (userGuessSuccessFalse){
            case '胜':
                if(userHomeTeamResultScore <= (userGuestTeamResultScore+plate)){
                    msg='在选择胜的情况下，主队比分不能小于客队（含净胜球差）';
                    $(".msg").html('在选择胜的情况下，主队比分不能小于客队（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false;
                }
                break;
            case '负':
                if(userHomeTeamResultScore >= (userGuestTeamResultScore+plate)){
                    msg='在选择负的情况下，主队比分不能大于客队（含净胜球差）'
                    $(".msg").html('在选择负的情况下，主队比分不能大于客队（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false
                }
                break;
            case '平':
                if(userHomeTeamResultScore != (userGuestTeamResultScore+plate)){
                    msg='在选择平的情况下，主队比分必须等于客队比分（含净胜球差）';
                    $(".msg").html('在选择平的情况下，主队比分必须等于客队比分（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false
                }
                break;
            default:
                $(".msg").html('发生了无法预知的错误，请联系管理员').stop().slideDown().delay(2000).slideUp()
                flag=false
                break;
        }
        return {
            flag:flag,
            msg:msg
        };
    }
    
//    点击提示关闭按钮
    $('.tips .close').click(function () {
        $('.tips').hide();
    })
})
</script>
</body>
</html>