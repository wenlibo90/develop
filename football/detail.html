<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=750px,user-scalable=no">
<title>Russia世界杯</title>
<link rel="stylesheet" href="css/style.css"/>
    <link rel="stylesheet" href="http://static.yuntongauto.com/yth/meber/css/animate.css">
<style>
body{
	background:#f2f2f2
}
.box{
	background:url(images/3-page.jpg) no-repeat;
}
    .tips{
        position: fixed;
        z-index: 12;
        bottom: 0;
        top: 0;
        left: 0;
        width: 100%;
        display: none;
        background-color: rgba(0,0,0,.55);
    }
    .tipBox{
        position: relative;
        top: 300px;
        left: 50%;
        transform: translate(-50%);
        width: 535px;
        height: 250px;

        overflow: hidden;
        background: url(images/tips.png) no-repeat top center ;
    }
    .tips .close{
        display: block;
        position: absolute;
        top: 0;
        right:30px;
    }
    .tips .pDiv{
        font-size: 24px;
        width: 315px;
        color: #323232;
        margin: 100px 0 0 55px;
        overflow: hidden;
        line-height: 40px;
    }
.ruleList{
    display: none;
}
    .grass-t{
        position: relative;
    }
    .imgVs{
        position: absolute;
        display: block;
        top: 27px;
        left: 280px;
        height: 100px;
        animation-iteration-count:infinite;
    }
.score-team{position: relative}
    .imgVs2{
        height: 75px;    top: 54px;
        left: 247px;
        animation-iteration-count:infinite;
    }
    .warn{
        text-align: center;
        font-size: 24px;
        color: #d33c3e;
    }
.guss-score{
    margin: 13px 0 22px;
}
</style>
</head>

<body>
<div class="loginBox">
    <div class="login">
        <span class="close">&times;</span>
        <p class="tit">登录</p>
        <p class="t-cont">
            <input type="text" placeholder="请输入您的姓名" id="uName">
        </p>
        <p class="t-cont">
            <input type="number" placeholder="请输入您的手机号" id="uCall" maxlength="11">
            <span class="yzm">获取验证码</span>
        </p>
        <p class="t-cont">
            <input type="number" placeholder="请输入验证码" id="uCode" maxlength="6">
        </p>
        <a href="javascript:void(0)" class="loginBtn">确认并提交</a>
    </div>
</div>
<div class="msg"></div>
<!--吃球球 动画-->
<div class="loadBox">
    <div class="loader">
        <div class="loader-inner pacman">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    服务请求中，请稍后
</div>
<div class="box">
	<div class="record"></div>
    <div class="rule-btn"></div>
    <div class="endtime"></div>
    <div class="cup">
        <img src="images/cup-1.png" class="cup-1" alt="">
        <img src="images/cup-2.png" class="cup-2" alt="">
    </div>
    <div class="rtk" style="margin-top: 160px"><marquee direction=left>竞猜赢大奖</marquee></div>
    <div class="grass" style="margin-bottom:165px">
    	<div class="grass-t"><i><img src="images/timg-16.png" width="130" height="130" /></i><span>葡萄牙</span><i class="n-right"><img src="images/timg-17.png" width="130" height="130" /></i><span class="n-right">西班牙</span></div>
        <ul class="grass-type">
            <li class="on">专家</li><li>职业</li><li>业余</li><span>（选择玩家级别）</span>
        </ul>
        <div class="guss-box">
        	<ul class="guss-win">
            	<h2><i></i>胜负关系竞猜</h2>
                <li class="win on">胜</li>
                <li class="lose">负</li>
                <li class="pin">平</li>
            </ul>
            
            <ul class="guss-ball">
            	<h2><i></i>大小球竞猜</h2>
                <li class="on">大</li>
                <li>小</li>
            </ul>
            <div class="guss-score">
            	<div class="score-team"><img src="images/vs_.png" class="imgVs imgVs2 animated tada"><i><img src="images/timg-16.png" width="67" height="67" /></i><span>葡萄牙</span><i class="n-right"><img src="images/timg-17.png" width="67" height="67" /></i><span class="n-right">西班牙</span></div>
                <div class="score-input">
                    <input type="number" placeholder="请输入比分" id="userHomeTeamResultScore" min="0"/><span>:</span>
                    <input type="number" placeholder="请输入比分" id="userGuestTeamResultScore" min="0"/>
                </div>
            </div>
        	<p class="warn"></p>
        </div>
    </div>
    <div class="submitBtn"><a href="javascript:void(0)">立即竞猜</a></div>
</div>
<div class="tips">
    <div class="tipBox">
       <img src="images/tipsCloseBtn.png" class="close">
       <div class="pDiv">
       </div>
    </div>
</div>
<div class="ruleList">
    <div class="ruleBox">
        <span class="closeBtn" style="display: block">&times;</span>
        <p class="title">足球嘉年华“世界杯”竞猜赛制</p>
        <p class="t1">赛制规则： <br>在线完成相应金额储值，即赠送 “运通嘉年华世界杯足球竞猜”活动资格。若猜中结果，还将获得相应比例储值金奖励。</p>
        <h3 class="h3">精彩一重礼</h3>
        <ul class="ruleUl">
            <li >
                <p style="height: 130px;"><strong>业余级：</strong>储值500元即可获得免拆清洗空调风道一次、单场业余级竞猜一次，竞猜须完成胜负关系竞猜及比分竞猜。</p>
                <span class="t5" style="height: 90px;">胜负关系竞猜正确额外赠送储值金额的40%；比分竞猜作为终极大奖筛选条件，比分猜错不影响单场竞猜结果。</span>
            </li>
            <li >
                <p style="height: 170px;"><strong>职业级：</strong>储值1000元即可获得免拆清洗空调风道一次、免拆清洗水箱冷凝器一次、单场职业级竞猜一次，竞猜须完成胜负关系竞猜、大小球竞猜及比分竞猜。</p>
                <span class="t5" style="height: 200px;">胜负关系竞猜正确赠送储值金额的40%，大小球竞猜正确赠送储值金额的30%，全部竞猜正确赠送储值金额的70%；<br>
比分竞猜作为终极大奖筛选条件，比分猜错不影响单场竞猜结果。</span>
            </li>
            <li >
                <p style="height: 170px;"><strong>专家级：</strong>储值3000元即可获得免拆清洗空调风道一次、免拆清洗水箱冷凝器一次氢氧除碳清洗一次，单场专家级竞猜一次，小组赛（A、B、C轮任意一轮）竞猜一次。</p>
                <span class="t5" style="height: 200px;">胜负关系竞猜正确赠送储值金额的40%，大小球竞猜正确赠送储值金额的30%，比分竞猜正确赠送储值金额的50%，全部竞猜正确赠送储值金额的120%； <br>
小组赛竞猜作为终极大奖筛选条件，猜错不影响单场竞猜结果。</span>
            </li>
        </ul>
        <div class="remarkUl">
            <p><span>1、比赛结果须在“净胜球差”基础上进行竞猜（以90分钟比赛结果为准）； <br>
2、储值部分及赠送部分均只用于机修保养使用，不可用于原厂精品、原厂零配件产品单独购买使用，不可以用于保险类产品购买使用；储值当天使用不得超过储值部分的50%；均不与其他任何优惠叠加使用。</span></p>
        </div>
        <h3 class="h3">精彩二重礼</h3>
        <ul class="ruleUl">
            <li >
                <p style="height: 45px;">进行“专家级”竞猜，除单场竞猜外，同时可以参与小组赛A、B、C轮（任意一轮）竞猜。</p>
            </li>
            <li >
                <p style="height: 110px;">A、B、C三轮竞猜正确场次数量累计最高的三名客户，可获得世界杯旅游基金。</p>
            </li>
        </ul>
        <h3 class="h3">精彩三重礼</h3>
        <ul class="ruleUl">
            <li >
                <p style="height: 110px;">活动期间，累计单场竞猜“胜负关系”正确次数最高的客户，可获得名下任意一台车辆终身免费基础保养资格。</p>
            </li>
        </ul>
    </div>
</div>
<script type="text/javascript" src="http://static.yuntongauto.com/js/jquery-1.9.1.min.js"></script>
<script src="http://static.yuntongauto.com/js/cookie.js" type="text/javascript"></script>
<script src="js/base.js"></script>
<script>
$(function(){
    init();
    var plate=0;
    function init() {
        setAjax('/footballGameGuess/selectPayManDesc',{},userShow)
        if(!getUrlParam().id){
            $(".msg").html('获取不到场次id').stop().slideDown().delay(2000).slideUp()
        }else{
            var data={
                id:getUrlParam().id
            }

            setAjax('/footballGame/getGameById',data,function (data) {
                if(data.success){
                    if(data.result.plate=='0'){
                        $('.endtime').html('净胜球差：平盘')
                    }else  if(Number(data.result.plate)<0){
                        $('.endtime').html('净胜球差：'+data.result.homeTeam+'加'+Math.abs(data.result.plate)+'球')
                    }else{
                        $('.endtime').html('净胜球差：'+data.result.homeTeam+'让'+data.result.guestTeam+''+data.result.plate+'球')
                    }


                    plate=data.result.plate;
                    $('.pDiv').html('<p>'+data.result.homeTeam+'本场比赛</p>' +
                            		'<p class="t-msg" data="'+data.result.plate+'">净胜球'+(data.result.plate+1)+'球（含）以上，为胜</p>')
                    $('.score-team').html('<img src="images/vs_.png" class="imgVs imgVs2 animated tada"><i><img src="'+data.result.homePicture+'" width="67" height="67" /></i><span>'+data.result.homeTeam+'</span><i class="n-right"><img src="'+data.result.guestPicture+'" width="67" height="67" /></i><span class="n-right">'+data.result.guestTeam+'</span>')
                    $('.grass-t').html('<img src="images/vs_.png" class="imgVs animated tada"><i><img src="'+data.result.homePicture+'" width="130" height="130" /></i><span>'+data.result.homeTeam+'</span><i class="n-right"><img src="'+data.result.guestPicture+'" width="130" height="130" /></i><span class="n-right">'+data.result.guestTeam+'</span>')
                }else{
                    $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
                }
            })
        }
    }
    function userShow(data) {
        if(data.success){
            var str='';
            $.each(data.result,function (i,v) {
                str += '<span style="padding-right: 120px">'+v+'</span>'
            })
            $('marquee').html(str)
        }else{
            $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
        }
    }
	$(".guss-box ul li").click(function() {
		$(this).addClass("on").siblings("li").removeClass("on"); 
	})
    $('.guss-win .win').click(function () {
		$(".t-msg").html('净胜球'+(parseInt(plate)+1)+'球（含）以上，为胜');
        $('.tips').show();
    })
	$('.guss-win .lose').click(function () {

		$(".t-msg").html('净胜球'+plate+'球(不含)以下，为负');
        $('.tips').show();
    })
	$('.guss-win .pin').click(function () {
		$(".t-msg").html('净胜球'+plate+'球，为平');
        $('.tips').show();
    })

    $(".grass-type li").click(function() {
		$(this).addClass("on").siblings("li").removeClass("on"); 
        var txt=$(this).html();
        if(txt=='业余'){
            $('.guss-ball').hide()
            $('.warn').html('')
        }else{
            $('.guss-ball').show()
            $('.warn').show()
        }
    })

    function aboutUserGuessBigSmall() {
        var userHomeTeamResultScore=$('#userHomeTeamResultScore').val();
        var userGuestTeamResultScore=$('#userGuestTeamResultScore').val();
        var sum=Number(userHomeTeamResultScore)+Number(userGuestTeamResultScore)
        console.log(sum)
        var userGuessBigSmall=$('.guss-ball li.on').html();
        switch (userGuessBigSmall){
            case '大' :
                if(sum<4){
                    $('.warn').html('当前竞猜比分与大小球选择不符合')
                }else{
                    $('.warn').html('')
                }
                break;
            case '小' :
                if(sum>=4){
                    $('.warn').html('当前竞猜比分与大小球选择不符合')
                }else{
                    $('.warn').html('')
                }
                break;
            default:
                $(".msg").html('出现了未知状态，联系管理员').stop().show()
                break;
        }
    }

    $('.score-input input').bind('input propertychange',function () {
        aboutUserGuessBigSmall()
    })

    $('.submitBtn a').click(function () {
        var gameId=getUrlParam().id;
        var userHomeTeamResultScore=$('#userHomeTeamResultScore').val();
        var userGuestTeamResultScore=$('#userGuestTeamResultScore').val();
        console.log(!userGuestTeamResultScore +'' + !userHomeTeamResultScore)
        var userGuessBigSmall=$('.guss-ball li.on').html();
        aboutUserGuessBigSmall()
        if(!gameId){
            $(".msg").html('未获取到场次id').stop().slideDown().delay(2000).slideUp()
        }else if(!userHomeTeamResultScore || !userGuestTeamResultScore){
            $(".msg").html('请输入比分').stop().slideDown().delay(2000).slideUp()
        }else{

            var level=$('.grass-type li.on').html();
            if(level=='业余'){
                userGuessBigSmall=null;
            }
            var gassWin=$('.guss-win li.on').html()
            var userId=cookie.getCookie('userId')
            var userGuessSuccessFalse=$('.guss-win li.on').html();
            if(userId){
                var data={
                    gameId:gameId,
                    userId:userId,
                    token:cookie.getCookie('token'),
                    level:level,
                    appId:sessionStorage.getItem('appId'),
                    userGuessBigSmall:userGuessBigSmall,
                    userGuessSuccessFalse:userGuessSuccessFalse,
                    userHomeTeamResultScore:userHomeTeamResultScore,
                    userGuestTeamResultScore:userGuestTeamResultScore
                }
<<<<<<< HEAD
                console.log(data)
=======
              //  alert(JSON.stringify(data))
>>>>>>> parent of 0bfe6fa... 版本提交
                if(isTureSuccessFlase(userGuessSuccessFalse,userHomeTeamResultScore,userGuestTeamResultScore).flag){
                    setAjax('/footballGameGuess/saveFootballGameGuess',data,function (data) {
                        console.log(data)
                        if(data.success){
                            //跳转到服务端支付页面
                            window.location.href=data.result;

                        }else{
                           if(data.code=='0'){
                               $('.loginBox').show();
                           }else{
                               $(".msg").html(data.message).stop().slideDown().delay(2000).slideUp()
                           }
                        }
                    })
                }
            }else{
                $('.loginBox').show();
            }
        }

    })
    function isTureSuccessFlase(userGuessSuccessFalse,userHomeTeamResultScore,userGuestTeamResultScore) {
        var flag=true;
        var msg=null;
        userHomeTeamResultScore=Number(userHomeTeamResultScore)
        userGuestTeamResultScore=Number(userGuestTeamResultScore)
        plate=Number(plate)?Number(plate):0;

        switch (userGuessSuccessFalse){
            case '胜':
                if(userHomeTeamResultScore <= (userGuestTeamResultScore+plate)){
                    msg='在选择胜的情况下，主队比分不能小于客队（含净胜球差）';
                    $(".msg").html('在选择胜的情况下，主队比分不能小于客队（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false;
                }
                break;
            case '负':
                if(userHomeTeamResultScore >= (userGuestTeamResultScore+plate)){
                    msg='在选择负的情况下，主队比分不能大于客队（含净胜球差）'
                    $(".msg").html('在选择负的情况下，主队比分不能大于客队（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false
                }
                break;
            case '平':
                if(userHomeTeamResultScore != (userGuestTeamResultScore+plate)){
                    msg='在选择平的情况下，主队比分必须等于客队比分（含净胜球差）';
                    $(".msg").html('在选择平的情况下，主队比分必须等于客队比分（含净胜球差）').stop().slideDown().delay(2000).slideUp()
                    flag=false
                }
                break;
            default:
                $(".msg").html('发生了无法预知的错误，请联系管理员').stop().slideDown().delay(2000).slideUp()
                flag=false
                break;
        }
        return {
            flag:flag,
            msg:msg
        };
    }
    
//    点击提示关闭按钮
    $('.tips').click(function () {
        $('.tips').hide();
    })
    //大小球
    $('.guss-ball li').click(function () {
        var txt=$(this).html();
        if(txt=='大'){
            $('.pDiv').html('<p class="t-msg">90分钟内累计有效进球数3球以上（不含3球）算大球</p>')
        }else{
            $('.pDiv').html('<p class="t-msg">90分钟累计有效进球数3球以内（含3球）算小球</p>')
        }
        $('.tips').show();
    })
//    规则显示
    var flag=true;
//    活动规则
    $('.rule-btn').click(function () {
        $('.ruleList').show();
        if(!flag){
            $('.ruleList .close').hide()
            $('.ruleList .closeBtn').show()
        }
    })

    $('.ruleList .close').click(function () {
        $('.ruleList').hide();
        flag=!flag;
    })
    $('.ruleList .closeBtn').click(function () {
        $('.ruleList').hide();
    })
    $('.endtime').click(function () {
        $('.msg').stop().css('top','300px').html('每场比赛，根据比赛双方实力差距开出该场比赛的净胜球差(均以90分钟比赛结果为准)。 <br/>' +
                '<p style="font-size: 22px;margin-top: 10px">例如:德国VS墨西哥 <br/>' +
                '净胜球差：德国让2球(让球方赢2球（不含2球）以下为输，赢2球为平，赢2球（不含2球）以上为赢)。<br/>' +
                '如最终比分：德国2:1墨西哥，德国输球；德国2:0墨西哥，德国平球；德国3:0墨西哥，德国赢球；</p>').show().click(function () {
            $(this).hide()
        });
        event.stopPropagation()
    })
})
</script>
</body>
</html>