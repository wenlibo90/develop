<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>运通嘉年华-7×24小时</title>
    <meta name="viewport" content="width=750px,user-scalable=no">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
<div class="topBg">
    <a href="javascript:void(0)" class="rule_1"><img src="img/rule-1.png" alt=""></a>
    <a href="javascript:void(0)" class="myRecord"><img src="img/record.png" alt=""></a>
    <img src="img/m-1.png" alt="" class="money money_1 animated">
    <img src="img/m-2.png" alt="" class="money money_2 animated">
    <img src="img/m-3.png" alt="" class="money money_3 animated">
    <div class="redBox">
        <img src="img/red-1.png" alt="" class="money red-1 animated">
        <img src="img/red-2.png" alt="" class="money red-2 animated">
    </div>
    <div class="txtBox">
        <img src="img/txt-1.png" class="txt_1 l">
        <img src="img/724.png" class="txt_2 r animated tada">
        <img src="img/firework.png" class="firework animated zoomIn">
        <img src="img/star-1.png" class="money star star1 animated rotateIn">
        <img src="img/star-2.png" class="money star animated rotateIn">
        <img src="img/star-1.png" class="money star star3 animated rotateIn">
        <div class="clear"></div>
    </div>
    <img src="img/car.png" alt="" class="carBg animated">
</div>
<div class="contBox">
    <div class="cont_1">
        <img src="img/ball.png" alt="" class="starBall">
        <p class="tit-1">今天距离活动结束</p>
        <p class="timeBox">
            <!--<span class="ballBg"></span><span>:</span>
            <span class="ballBg"></span><span>:</span>
            <span class="ballBg"></span><span>:</span>
            <span class="ballBg"></span>-->
        </p>
        <div class="cont1">
            <img src="img/txt-2.png" alt="" class="txt2 animated slideInUp">
            <a href="earnest.html" class="toPayBtn"><img src="img/toPay.png"></a>
        </div>
    </div>
    <div class="cont_2">
        <div class="turntable-bg">
            <img src="img/priceBtn.png" class="pointer">
            <div class="rotate">
                <img src="img/trubbleBg.png" id="rotate" class="rotate2">
            </div>
            <img src="img/red-1.png" class="red-3">
            <img src="img/m-4.png" class="money_4">
        </div>
        <p class="turntableRuleBtn">请详细阅读 <strong>抽奖规则</strong></p>
    </div>
    <div class="cont_3">
        <div class="trictBg trictBox1" data-goodid="8">
            <span class="rules"></span>
            <span class="getBtn" >免费领取</span>
        </div>
        <div class="trictBg trictBox2" data-goodid="7">
            <span class="rules"></span>
            <span class="getBtn" >免费领取</span>
        </div>
    </div>
    <p class="bottom">WINTOP</p>
    <p class="bottom">集团信息技术部提供技术支持</p>
</div>
<!--遮罩弹层-->
<div class="pop popLoginBox">
    <!--登录-->
    <div class="pop-login">
        <span class="close">&times;</span>
        <p class="tit">登录</p>
        <p class="t-cont">
            <input type="text" placeholder="姓名" id="uName">
        </p>
        <p class="t-cont">
            <input type="number" placeholder="手机号" id="uCall" maxlength="11">
            <span class="yzm">获取验证码</span>
        </p>
        <p class="t-cont">
            <input type="number" placeholder="验证码" id="uCode" maxlength="6">
        </p>
        <p class="shopListDiv">
            <span>选择经销店:</span><span class="shopListBtn"><select name="" id=""><option value="">未选择</option></select></span>
        </p>
        <a href="javascript:void(0)" class="loginBtn">确认并提交</a>
    </div>
</div>
<div class="pop popMsgBox">
    <!--提示-->
    <div class="pop-msg">
        <!--抽奖提示：抽中xxx；抽奖登录以后提示：已领取xxx,按钮显示‘查看记录’。领券提示：获得电动尾门试用机会一次/二手车1000元礼金券一张-->
        <div class="tit">抽中原厂玻璃水一瓶</div>
        <!--按钮状态：抽奖成功显示‘立即领取’，领券成功显示‘查看记录’-->
        <div class="btn">立即领取</div>
    </div>
</div>
<div class="loadBox">
    <div class="loader">
        <div class="loader-inner pacman">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
    服务请求中，请稍后
</div>
<div class="msg"></div>
<!--二手车通用券-->
<div class="pop usedcarRule">
    <div class="tips-rule" style="padding-bottom:50px">
        <div class="rule-top-e"><span>二手车通用券1000元</span></div>
        <div class="rule-rep">
            <p class="tit">使用规则</p>
            <p>可用于二手车购买时使用，可在成交价格基础上减少1000元；</p>
            <p>可用于二手车置换、寄卖时使用，可在成交价格基础上增加1000元；</p>
            <p>每个用户仅限领取一张；</p>
            <p>单笔交易仅限抵用一张；</p>
            <p>请到店消费时将此券领取记录向店内工作人员出示。</p>
            <p>有效期5个月（自充值之日起计算）。</p>
        </div>
        <div class="rule-btn"><a>我知道了</a></div>
    </div>
</div>
<!--电动尾门试用-->
<div class="pop doorRule" >
    <div class="tips-rule" style="margin-top: 200px">
        <div class="rule-top"></div>
        <div class="rule-rep">
            <p class="tit">使用规则</p>
            <p>此活动仅适用于运通汽车集团旗下经销店所覆盖的城市，如不覆盖，恕无法提供服务；</p>
            <p>报名后，店内工作人员会与您电话联系到店签署协议及安装事宜。</p>
        </div>
        <div class="rule-btn"><a>我知道了</a></div>
    </div>
</div>
<!--大转盘-->
<div class="pop turntableRule" style="overflow-y: scroll;">
    <div class="tips-rule" style="padding-bottom:50px">
        <div class="rule-top-e dzp"><span>每个用户仅限参与一次</span></div>
        <div class="rule-rep">
            <p class="tit">奖品说明：</p>
            <p><span>机滤一个</span><br/>仅限到店使用，有效期一年，自发放之日起计算；</p>
            <p><span>享受一次免工时更换防冻液</span><br/>有效期一年，自发放之日起计算；</p>
            <p><span>续保代金券500元</span><br/>有效期一年，自发放之日起计算，不与其他优惠同享；</p>
            <p><span>低温等离子空气净化清风系统</span><br/>一个月免费试用权；仅适用于运通汽车集团旗下经销店所覆盖的城市，如不覆盖，恕无法提供服务；店内工作人员会电话联系您到店签署协议
                及告知您相关安装事宜。</p>
            <p><span>威固赞助瑞典拓乐高端运动背包10个</span><br/>工作人员会电话联系您邮寄事宜。</p>

        </div>
        <div class="rule-btn"><a>我知道了</a></div>
    </div>
</div>
<!--活动总规则-->
<div class="pop tipsRule" style="overflow: scroll">
    <div class="tips-rule" style="padding-bottom:50px">
    	<!--基础保养买一赠一-->
        <div class="rule-top-e" style="background:url(img/r-tctops-1.png)"><span>基础保养买一赠一活动参与订金</span></div>
        <div class="rule-rep">
            <p>购买此订金产品即可参与运通汽车集团旗下所有经销店基础保养买一赠一活动；此订金可在实际购买基础保养买一赠一产品时进行抵用；</p>
            <p>此订金可多次购买，可一次购买多份一份订金只对应一份基础保养买一赠一产品；</p>
            <p>预付订金后，应在活动期间内（7月24-30日内）前往所选经销店进行后续费用补交，或与店内工作人员联系在线上完成费用补交，逾期未进行费用补交，则视为放弃本次活动，请联系经销店进行订金退款；</p>
            <p>订单中您所填写的姓名及联系方式是我们确认您购买的唯一途径，请务必保证填写正确；</p>
            <p>此次活动中基础保养产品有效期为5年（自充值之日起计算）。</p>
        </div>
        
        <!--大转盘-->
        <div class="rule-rep">
        	<div class="rule-top-tit">幸运大转盘</div>
            <p class="tit">奖品说明：</p>
            <p><span>机滤一个</span><br/>仅限到店使用，有效期一年，自发放之日起计算；</p>
            <p><span>享受一次免工时更换防冻液</span><br/>有效期一年，自发放之日起计算；</p>
            <p><span>续保代金券500元</span><br/>有效期一年，自发放之日起计算，不与其他优惠同享；</p>
            <p><span>低温等离子空气净化清风系统</span><br/>一个月免费试用权；仅适用于运通汽车集团旗下经销店所覆盖的城市，如不覆盖，恕无法提供服务；店内工作人员会电话联系您到店签署协议
                及告知您相关安装事宜。</p>
            <p><span>威固赞助瑞典拓乐高端运动背包10个</span><br/>工作人员会电话联系您邮寄事宜。</p>
        </div>
        
        <!--电动尾门试用-->
        <div class="rule-rep">
        	<div class="rule-top-tit">电动尾门试用</div>
            <p class="tit">使用规则</p>
            <p>此活动仅适用于运通汽车集团旗下经销店所覆盖的城市，如不覆盖，恕无法提供服务；</p>
            <p>报名后，店内工作人员会与您电话联系到店签署协议及安装事宜。</p>
        </div>
        
        <!--二手车通用券-->
        <div class="rule-rep">
        	<div class="rule-top-tit">二手车通用券1000元</div>
            <p class="tit">使用规则</p>
            <p>可用于二手车购买时使用，可在成交价格基础上减少1000元；</p>
            <p>可用于二手车置换、寄卖时使用，可在成交价格基础上增加1000元；</p>
            <p>每个用户仅限领取一张；</p>
            <p>单笔交易仅限抵用一张；</p>
            <p>请到店消费时将此券领取记录向店内工作人员出示。</p>
            <p>有效期5个月（自充值之日起计算）。</p>
        </div>
        <div class="rule-btn"><a>我知道了</a></div>
    </div>
</div>
<div class="descrp"></div>
</body>
<script src="http://static.yuntongauto.com/js/jquery.min.js"></script>
<script src="js/awardRotate.js"></script>
<script src="js/common.js"></script>
<script>
    var nowTime;
    $(function () {
      //  初始化
      init()

       $('.trictBg .rules').click(function () {
           if($(this).parent('.trictBg').attr('data-goodid')  == 8){
                $('.doorRule').show()
           }else{
               $('.usedcarRule').show()
           }
       })
        //规则关闭
        $('.rule-btn a').click(function () {
            $(this).parents('.pop').hide()
        })
        //大转盘规则
        $('.turntableRuleBtn').click(function () {
            $('.turntableRule').show();
        })
        //总规则
        $('.rule_1').click(function () {
            $('.tipsRule').show()
        })
        //二手车 电动尾门规则
        $('.getBtn').click(function () {
            if(!compareDate(nowTime)) return;
            var gooid=$(this).parent('.trictBg').attr('data-goodid')
            sessionStorage.setItem('productId',gooid)
            if(base.cookie.getCookie('token')){

                var data={
                    carnivalProductId:sessionStorage.getItem('productId'),
                    appId:sessionStorage.getItem("appId"),
                    token:base.cookie.getCookie('token')
                }
                var url='/carnival/savecashgiftorder';
                if(Number(gooid) == 8){
                    url='/carnival/savebackdoororder';
                }
                base.setAjax(url,data,function (data) {
                    console.log(data)
                    if(data.code==0){
                        $('.popLoginBox').show();
                    }else{
                        if(sessionStorage.getItem('productId') == 8){
                            $('.popMsgBox').show()
                            //$('.popMsgBox').stop().slideDown().delay(5000).slideUp()
                            $('.pop-msg .tit').html('电动尾门试用')
                            $('.pop-msg .btn').html('<a href="record.html" style="display: block;" class="torecord">查看记录</a>')
                        }else{
                            $('.popMsgBox').show()
                            $('.pop-msg .tit').html('二手车礼金')
                            $('.pop-msg .btn').html('<a href="record.html" style="display: block;" class="torecord">查看记录</a>')
                        }
                        if(data.code==2){
                            $('.pop-msg .tit').html('您已领取过，不能重复领取')
                        }
                        $('.torecord').click(function () {
                            $('.popMsgBox').hide()
                        })
                    }
                })
            }else{
                $('.popLoginBox').show();
            }

        })

        //转盘选择开关
        var bRotate = false;
        //旋转函数
        var rotateFn = function (awards, angles, txt,goodid,code){
            bRotate = !bRotate;
            $('#rotate').stopRotate();
            $('#rotate').rotate({
                angle:0,
                //基本旋转 1800度
                animateTo:angles+1800,
                duration:8000,
                callback:function (){
                    var msgBox=$('.popMsgBox');
                    msgBox.show();
                    $('.pop-msg .tit').html(txt);
console.log(code)
                    if(code == 0){
                        msgBox.show();
                        $('.pop-msg .btn').html('<a href="javascript:void(0)" class="getGits toLogin" style="display: block;">立即领取</a>')
                    }else if(code == 2){
                        msgBox.hide();
                        alert('你已参与过抽奖，不能重复参与！')
                        //$(".descrp").html('你已参与过抽奖，不能重复参与！').show().delay(2000).hide()
                    }else if(code == 3){
                        msgBox.hide();
                        alert('领取失败，请联系管理员')
                        //$(".descrp").html('领取失败，请联系管理员').show().delay(2000).hide()
                    }else{
                        msgBox.show();
                        $('.pop-msg .btn').html('<a href="javascript:void(0)" class="getGits" style="display: block;">已成功领取</a>')
                    }
                    sessionStorage.setItem('productId',goodid)
                    bRotate = !bRotate;
                    $('#rotate').addClass('rotate2');
                    $('.getGits').click(function () {
                        if($(this).hasClass('toLogin')){
                            $('.popLoginBox').show();
                        }
                        $('.popMsgBox').hide()
                    })
                }
            })
        };
        //开启旋转
        $('.pointer').click(function (){
            if(!compareDate(nowTime)) return;
            $('#rotate').removeClass('rotate2');
            if(bRotate)return;
            sessionStorage.removeItem('productId')
            var data={
                carnivalProductId:null,
                token:base.cookie.getCookie('token'),
                appId:sessionStorage.getItem('appId')
            }

            $.ajax({
                type:'get',
                url:base.path+'/carnival/insertturnplateorder',
                dataType:'jsonp',
                data:data,
                jsonpCallback:'callback',
                success:function(data){
                    var item=data.result.id;
                    //谢谢参与 概率为0
                    var arrDial=[
                        {
                            angle:0,
                            Prize:'机滤一个',
                            id:2
                        },
                        {
                            angle:-61,
                            Prize:'续保代金券500元'
                            , id:3
                        },
                        {
                            angle:-120,
                            Prize:'瑞典拓乐高端运动背包'
                            , id:4
                        }
                        ,
                        {
                            angle:-180,
                            Prize:'免工时更换防冻液',
                            id:5
                        },
                        {
                            angle:-240,
                            Prize:'等离子空气净化试用一个月',
                            id:6
                        },
                        {
                            angle:-300,
                            Prize:'谢谢参与'
                        }
                    ];
                    var angle,Prize;
                    var code=data.code;
                    console.log(data)
                    $.each(arrDial, function (index, value){
                        if(item == value.id){
                            angle=value.angle;
                            Prize=value.Prize;
                            console.log(code)
                            rotateFn(item, angle, Prize,item,Number(code))
                        }
                    })
                },
                error:function(){
                    $('.msg').html('服务器异常').fadeIn(100).delay(1500).hide()
                }
            })

        });


        $('.myRecord').click(function () {
            sessionStorage.removeItem('productId')
            if(loginObj.isLogin()){
                window.location.href='record.html'
            }
        })


    });
    function compareDate(date){
        //对获得的时间戳区间与既定的时间戳进行比对
        var bDate='2018-07-24 00:00:00'.replace(/-/g, "/");
        var cDate='2018-07-30 17:00:00'.replace(/-/g, "/");
        bDate=new Date(bDate).getTime();
        cDate=new Date(cDate).getTime();
        if(date < bDate){
            alert('活动于7月24日0点开启，敬请期待！')
            return false
        }else if(date >= cDate){
            alert('活动已结束')
            return false
        }
    }
    function init() {
        //获取分享id
        sessionStorage.setItem("shareId", getUrlParam().id)
        //倒计时
        mygetTime()
        function mygetTime(){
            base.setAjax('/carnival/gettime',{},function (data) {
                nowTime=data.result;
				sessionStorage.setItem("nowTime", nowTime);
            })
        }
            var timer=setInterval(function(){
                    var date = new Date('2018-07-30 17:00:00'.replace(/-/g, "/"));
                    var obj=base.timeEnd(timer,date)
                    $('.timeBox').html(' <span class="ballBg">'+obj.days+'</span><span>天</span>\n' +
                            '            <span class="ballBg">'+obj.hours+'</span><span>小时</span>\n' +
                            '            <span class="ballBg">'+obj.minutes+'</span><span>分</span>\n' +
                            '            <span class="ballBg">'+obj.seconds+'</span><span>秒</span>')
            }, 1000)





        //获取当前4s店appid
        sessionStorage.setItem("appId", base.appIdArr[10 <= getUrlParam().id ? getUrlParam().id : getUrlParam().id.slice(1)])
        console.log(sessionStorage.getItem("appId"))
        if(getUrlParam().id != '01'){
            $('.shopListDiv').hide();
        }else{
            $.ajax({
                type:'get',
                url:base.path+'/carnival/getservicenetworklist',
                dataType:'jsonp',
                //jsonpCallback:'callback',
                success:function(data){
                    console.log(data.result)
                    $.each(data.result,function (index, v) {
                        $('.shopListBtn select').append('<option value="'+v.id+'">'+v.simpleName+'</option>')
                    })
                },
                error:function(){
                    $('.msg').html('服务器异常').fadeIn(100).delay(1500).hide()
                }
            });
           /* base.setAjax('/carnival/getservicenetworklist',{},function (data) {
                console.log(data.result)
                $.each(data.result,function (index, v) {
                    $('.shopListBtn select').append('<option value="'+v.id+'">'+v.simpleName+'</option>')
                })
            })*/
            $('.city').click(function () {
               console.log($('.city').attr('data-id'))
            })
        }
        //主题图片加载完执行 images
        //动画样式添加
        $('.carBg').addClass('slideInUp')
        $('.money_1').addClass('rotateInDownLeft')

        $('.money_2').addClass('rotateInDownRight')
        $('.money_3').addClass('rotateInDownRight')
        $('.red-1').addClass('rotateInDownLeft')
        $('.red-2').addClass('rotateInDownRight')

    }
	
	//sessionStorage.getItem("shareId")

</script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="http://yth.yuntongauto.com/js/weixin-wintop-1.0.js"></script>
<script>weixin_sdk.PAGE.init({
    basePath: "http://yth.yuntongauto.com",
    share_title: "运通嘉年华",
    share_link: "http://static.yuntongauto.com/web/carnival-2018/index.html?id=01",
    share_desc: "运通嘉年华，运通伴您惠享7×24小时",
    share_imgUrl: "http://static.yuntongauto.com/web/carnival-2018/img/weixin.jpg",
    wechatPlatformId: "3036684041086976"
})</script>
</html>