<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=750px,user-scalable=no">
    <title>运通嘉年华-7×24小时</title>
    <link rel="stylesheet" href="css/style.css"/>
</head>

<body>

<div class="box">
    <div class="ea-top"><img src="img/r-tearnest.jpg" /></div>
    <ul class="ea-rule">
        <li class="tit">使用规则:</li>
        <li><i>1</i>购买此订金产品即可参与运通汽车集团旗下所有经销店基础保养买一赠一活动；此订金可在到店实际购买基础保养买一赠一产品时进行抵用；</li>
        <li><i>2</i>此订金可多次购买，可一次购买多份，一份订金只对应一份基础保养买一赠一产品；</li>
        <li><i>3</i>预付订金后，应在活动期间内（7月24-30日内）前往所选经销店进行后续费用补交，或与店内工作人员联系在线上完成费用补交，逾期未进行费用补交，则视为放弃本次活动，请联系经销店进行订金退款；</li>
        <li><i>4</i>订单中您所填写的姓名及联系方式是我们确认您购买的唯一途径，请务必保证填写正确；</li>
        <li><i>5</i>此次活动中基础保养产品有效期为5年（自充值之日起计算）。</li>
    </ul>
    <a class="ea-btn">立即支付订金</a>
    
    <!--登录-->
    <div class="pop popLoginBox">
        <!--登录-->
        <div class="pop-login">
            <span class="close">&times;</span>
            <p class="tit">登录</p>
            <p class="t-cont">
                <input type="text" placeholder="姓名" id="uName">
            </p>
            <p class="t-cont">
                <input type="number" placeholder="手机号" id="uCall" maxlength="11">
                <span class="yzm">获取验证码</span>
            </p>
            <p class="t-cont">
                <input type="number" placeholder="验证码" id="uCode" maxlength="6">
            </p>
            <p class="shopListDiv">
                <span>选择经销店:</span><span class="shopListBtn"><select name="" id=""><option value="">未选择</option></select></span>
            </p>
            <a href="javascript:void(0)" class="loginBtn">确认并提交</a>
        </div>
    </div>

</div>

<script src="http://static.yuntongauto.com/js/jquery.min.js"></script>
<script src="js/common.js"></script>
<script>
    $(".ea-btn").click(function () {
		if(!compareDate(sessionStorage.getItem("nowTime"))) return;
        var param= {
            "appId": sessionStorage.getItem("appId"),
            "token": base.cookie.getCookie('token'),
            "carnivalProductId":1
        }

        //base.cookie.setCookie("token");
        if (loginObj.isLogin()){
			//已登录处理逻辑
            base.setAjax('/carnival/inserteernestorder',param,function (data) {
                if(data.success){
                    window.location.href = "http://test.yuntongauto.com/pay/gotocarnivalpay?carnivalOrderId="+data.result+"&appId="+sessionStorage.getItem("appId");
                }else{
                    //接口返回失败处理
                }
            })
        }
		
		//获取当前4s店appid
        if(sessionStorage.getItem("shareId") != '01'){
            $('.shopListDiv').hide();
        }else{
            $.ajax({
                type:'get',
                url:base.path+'/carnival/getservicenetworklist',
                dataType:'jsonp',
                //jsonpCallback:'callback',
                success:function(data){
                    console.log(data.result)
                    $.each(data.result,function (index, v) {
                        $('.shopListBtn select').append('<option value="'+v.id+'">'+v.simpleName+'</option>')
                    })
                },
                error:function(){
                    $('.msg').html('服务器异常').fadeIn(100).delay(1500).hide()
                }
            });
           
            $('.city').click(function () {
               console.log($('.city').attr('data-id'))
            })
        }
		
		function compareDate(date){
			//对获得的时间戳区间与既定的时间戳进行比对
			var bDate='2018-07-24 00:00:00'.replace(/-/g, "/");
			var cDate='2018-07-30 17:00:00'.replace(/-/g, "/");
			bDate=new Date(bDate).getTime();
			cDate=new Date(cDate).getTime();
			if(date < bDate){
				alert('活动于7月24日0点开启，敬请期待！')
				return false
			}else if(date >= cDate){
				alert('活动已结束')
				return false
			}else{
				return true
			}
		}

    });

</script>
</body>
</html>