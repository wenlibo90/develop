<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
	</head>

	<body class="layui-field-box">
          <div class="layui-field-box layui-form">
              <div class="layui-input-inline" style="width:220px"><input id="orderName" placeholder="订单编号/姓名/电话号/车辆编号" class="layui-input" type="text"></div>
              <div class="layui-input-inline">
                  <select class="layui-input" id="orderStatus">
                      <option value="0">全部状态</option>
                      <option value="1">等待付款</option>
                      <option value="2">付款信息待审核</option>
                      <option value="3">过户处理中</option>
                      <option value="4">争议处理中</option>
                      <option value="5">违约金支付确认中</option>
                      <option value="6">手续回传待确认</option>
                      <option value="7">交易完成</option>
                      <option value="8">交易关闭</option>
                  </select>
              </div>
              <div class="layui-btn" id="condition"><i class="fa fa-search"></i>查询</div>
              <div class="layui-btn"><i class="fa fa-arrow-circle-o-up"></i>&nbsp;导出</div>
          </div>
          <div class="layui-field-box">
              <table class="layui-table">
                  <thead>
                      <tr>
                          <th>订单编号</th>
                          <th>买家姓名</th>
                          <th>买家电话</th>
                          <th>车辆编号</th>
                          <th>车辆名称</th>
                          <th>竞拍类型</th>
                          <th>成交价</th>
                          <th>应付总金额</th>
                          <th>实付总金额</th>
                          <th>订单状态</th>
                          <th>创建时间</th>
                          <th>成交确认单</th>
                      </tr>
                  </thead>
                  <tbody id="tb_order">
                     
                  </tbody>
              </table>
              <div id="page"></div>
          </div>

	</body>
    
    <script type="text/javascript" src="plugins/layui/layui.all.js"></script>
	<script type="text/javascript" src="js/common/common_sup.js"></script>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script>
		$(function(){
			init();//第一次页面初始化
			init_lab();//条件查询及其他标签绑定
		})
		var uri_order ='/boss/order/selectOrderList';
        var limit=15;
        function init_lab(){
        	$("#condition").on("click",function(){
        		var type = $("#orderStatus").val()==0?null: $("#orderStatus").val();//判断订单状态
        		var orderName  = $("#orderName").val().trim();
        		init(type,orderName==""?null:orderName);
        	});
        }
  		function init(orderStatus,searchName,orderBeginTime,orderEndTime){
  			var data_order = {
  			"page":1,
            'limit':limit,
			"orderStatus": orderStatus
			,"searchName":searchName
			,"orderBeginTime":orderBeginTime
			,"orderEndTime":orderEndTime
		};
			var  map_name = ['orderNo','userName','mobile',
			'carAutoNo','autoInfoName','auctionType','transactionFee','amountFee','payFee'
			,'status','createTime'];
			var result_order =  sup_ajax(uri_order,data_order,false);
			if(!check_str(result_order,'result')){
				layer.msg("网络或服务器异常，页面加载失败");
			}
			count = result_order.data.count;

            layui.use(['table','laypage'], function(){
                var $= layui.jquery,layer = layui.layer,laypage = layui.laypage,form = layui.form,upload = layui.upload;
                laypage.render({
                    elem: 'page',
                    limit: limit,
                    count: count,
                    jump: function(obj)
                {
                    var data_order = {
                        "page":obj.curr,
                        'limit':limit,
                        "orderStatus": orderStatus
                        ,"searchName":searchName
                        ,"orderBeginTime":orderBeginTime
                        ,"orderEndTime":orderEndTime
                    };
                        result_order =  sup_ajax(uri_order,data_order,false);
                        count = result_order.data.count;
                        if(count==0){
                            $("#tb_order").html('<td colspan="11" style="text-align:center;height:200px">暂无订单信息！</td>');
                            return;
                        }
                        var html='';
                        for(var i=0;i<result_order.data.list.length;i++){
                            html+='<tr>'
                            for(var j=0;j<11;j++){
                                html+='<td>';
                                if(eval('result_order.data.list[i].'+map_name[j])!=null){
                                    if(j==6||j==7||j==8){
                                        html+=eval('result_order.data.list[i].'+map_name[j])+'元';
                                        continue;
                                    }
                                    else if(j==10){
                                        html+=timeFormat(eval('result_order.data.list[i].'+map_name[j]));
                                        continue;
                                    }
                                    else if(j==5){
                                        var tp = Number(eval('result_order.data.list[i].'+map_name[j]));
                                        switch(tp){
                                            case 1:
                                                html+='线上';
                                                break;
                                            case 2:
                                                html+='线下';
                                        }
                                        continue;
                                    }
                                    else if(j==9){

                                        var tp = Number(eval('result_order.data.list[i].'+map_name[j]));
                                        switch(tp){
                                            case 1:
                                                html+='等待付款';
                                                break;
                                            case 2:
                                                html+='付款信息待审核';
                                                break;
                                            case 3:
                                                html+='过户处理中';
                                                break;
                                            case 4:
                                                html+='争议处理中';
                                                break;
                                            case 5:
                                                html+='违约金支付确认中';
                                                break;
                                            case 6:
                                                html+='手续回传待确认';
                                                break;
                                            case 7:
                                                html+='交易完成';
                                                break;
                                            case 8:
                                                html+='交易关闭';
                                                break;

                                        }
                                        continue;
                                    }
                                    else if(j==0){
                                    	html+='<a href="order-detail.html?orderId='+result_order.data.list[i].id+'">'+eval('result_order.data.list[i].'+map_name[j])+'</a>';
                                    	continue;
                                    }
                                    
                                    html+=eval('result_order.data.list[i].'+map_name[j]);
                                }
								
                                html+='</td>';
								
                            }
							
							//添加打印
							html+='<td><a href="javascript:;" class="layui-btn layui-btn-xs layui-btn-danger print" data="'+result_order.data.list[i].id+'">打印</a></td>';
							
                            html+='</tr>';
                        }
                       
                        $("#tb_order").html(html);
						
						$(".print").on("click",function(){
							var id=$(this).attr("data");
							layer.full(layer.open({
								title: '成交确认单',
								type: 2,
								shade: 0,//不显示遮罩
								content: 'print.html?id='+id
							}));
							
						});
                    }
                })
            });
  		}
		
		
  		
    </script>

</html>