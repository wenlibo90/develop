<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
</head>

<body>

<div class="layui-field-box">
    <div class="layui-tab-content" style="height:560px">
        <div class="layui-tab-item layui-show">
            <div class="layui-field-box">
                <div class="layui-input-inline" style="width:220px"><input placeholder="用户姓名/手机号" class="layui-input" type="text"></div>
                <div class="layui-btn"><i class="fa fa-search"></i>查询</div>
                <div class="layui-btn opre_user"><i class="layui-icon">&#xe608;</i>&nbsp;新增</div>
            </div>
            <div class="layui-field-box layui-form">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>登录账号</th>
                            <th>用户姓名</th>
                            <th>联系电话</th>
                            <th>角色类型</th>
                            <th>角色名称</th>
                            <th>备注</th>
                            <th width="180">操作</th>
                        </tr>
                    </thead>
                    <tbody id="user_list">

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="plugins/layui/layui.all.js"></script>
<script type="text/javascript" src="js/common/common_sup.js"></script>
<script>
layui.use(['element','table'], function(){
	
	var $ = layui.jquery ,element = layui.element,laypage = layui.laypage;
	
	$(function(){
		//初始化
		user_set();
		
		//新增、修改用户
		$(".opre_user").on('click', function(){
			var user_id;
			var id = $(this).attr("data");
			if(id != undefined){
				user_id = "?id=" + id
			}else{
				user_id = ""
			}
			layer.full(layer.open({
				title: '新增用户',
				type: 2,
				shade: 0,
				content: 'set-user-add.html' + user_id
			}));
		})
	})
	 
	 //用户设置
	 function user_set() {
		var url = "/boss/managerUser/selectManagerUserList";
		var data = {
			"page":1,
			"limit":100 
		};
		var data = sup_ajax(url, data, false);
		var list = data.data.list;
		if(data == null || data.success == false || data.data.count==0){
			$('#user_list').html('<tr><td colspan="6" style="text-align:center;height:200px">返回数据为空，没有用户信息！</td></tr>');
			return;
		}else{
			$('#user_list').html('');
			$.each(list,function(i,r){
			  $('#user_list').append('<tr>' +
				  '<td>'+r.userKey+'</td> ' +
				  '<td>'+r.userName+'</td> ' +
				  '<td>'+r.userPhone+'</td> ' +
				  '<td>'+r.roleTypeName+'</td> ' +
				  '<td>'+r.roleName+'</td> ' +
				  '<td>'+r.remark+'</td> ' +
				  '<td><a href="javascript:;" class="layui-btn layui-btn-xs reset" data="'+r.id+'">密码重置</a><!--<a href="javascript:;" class="layui-btn layui-btn-xs opre_user" data="'+r.id+'">修改</a>--><a href="javascript:;" class="layui-btn layui-btn-danger layui-btn-xs del" data="'+r.id+'" type="user">删除</a></td></tr>')
			})
		};
		
		//删除
		$(".del").on('click', function(){
			var d = $(this).attr("data");
			var url = "/boss/managerUser/deleteManagerUser";
			parent.layer.confirm('是否删除？',{shade:0}, function(index){
				parent.layer.close(index);
				var result = sup_ajax(url, {id:d}, false);
				if(result==null || result.success == false || result.resultCode!=100){
					layer.msg("接口返回异常！");
					return;
				}
				layer.msg(result.resultMsg);
				//重新加载
				user_set();
			});
		})
		
		//密码重置
		$(".reset").on('click', function(){
			var d = $(this).attr("data");
			var url = "/boss/managerUser/resetUserPassword";
			var data = {
				userId:d
			};
			parent.layer.confirm('确认重置密码？',{shade:0}, function(index){
				parent.layer.close(index);
				var result = sup_ajax(url, data, false);
				layer.msg('重置成功，请牢记！密码是'+result.data.newPassword,{closeBtn:1,time:0});
			});
		})
	 }
  
});
</script>

</body>
</html>