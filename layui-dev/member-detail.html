<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
</head>

<body>

<div class="layui-field-box" style="background:#fff">
    <div class="layui-tab">
        <ul class="layui-tab-title"><li class="layui-this" style="margin-left:24px">基本信息</li><li>订单信息</li><li>出价的车</li><li>关注的车</li><li>浏览的车</li></ul>
        <div class="layui-tab-content" style="height:560px">
            <div class="layui-tab-item layui-show">
            	<fieldset class="layui-elem-field" >
               	  <legend>会员详细：</legend>
                  <table class="layui-table" lay-skin="nob" style="width:470px;float:left">
                      <tbody id="vip_list_top">
                           <tr>
                              <td>会员状态：<b style="color:orange">已签约</b></td>
                              <td>可用保证金：<b style="color:orange">10000元</b></td>
                           </tr>
                           
                      </tbody>
                  </table>
                  <table class="layui-table" lay-skin="nob" style="width:auto;float:left;margin-top:68px">
                      <tbody id="idCard_tab">
                         
                      </tbody>
                  </table>
                </fieldset>
            	<fieldset class="layui-elem-field" id="vip_list_under">
               	 	
                </fieldset>
            </div>
            
            <div class="layui-tab-item">
            	<table class="layui-table">
                    <thead>
                        <tr>
                            <th>订单号</th>
                            <th>成交时间</th>
                            <th>车辆标题</th>
                            <th>车辆编号</th>
                            
                            <th>合手价</th>
                            <th>竞拍类型</th>
                            <th>是否代办</th>
                            <th>是否违约</th>
                            <th>违约说明</th>
                            <th>订单状态</th>
                            <th>备注</th>
                        </tr>
                    </thead>
                    <tbody id="vip_order_tab">
                        <tr><td colspan="11" style="text-align:center;height:200px">订单数据为空！</td></tr>
                    </tbody>
                </table>
            </div>
                        
            <div class="layui-tab-item">
            	<table class="layui-table">
                    <thead>
                        <tr>
                            <th>车辆编号</th>
                            <th>出价时间</th>
                            <th>车辆标题</th>
                            <th>车辆所属店铺</th>
                            <th>起拍价</th>
                            <th>委托价</th>
                            <th>我的最后出价</th>
                            <th>竞拍类型</th>
                            <th>竞拍结果</th>
                        </tr>
                    </thead>
                    <tbody id="vip_pay">
                         <tr><td colspan="11" style="text-align:center;height:200px">返回数据为空，没有出价的车！</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="layui-tab-item">
            	<table class="layui-table">
                    <thead>
                        <tr>
                        	<th>关注时间</th>
                            <th>车辆编号</th>
                            <th>车辆标题</th>
                            <th>车辆所属店铺</th>
                            <th>起拍价</th>
                            <th>最高出价</th>
                            <th>开拍时间</th>
                            <th>竞拍类型</th>
                        </tr>
                    </thead>
                    <tbody id="vip_follow">
                        <tr><td colspan="11" style="text-align:center;height:200px">没有关注的车辆！</td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="layui-tab-item">
            	<table class="layui-table">
                    <thead>
                        <tr>
                        	<th>浏览时间</th>
                            <th>车辆编号</th>
                            <th>车辆标题</th>
                            <th>车辆所属店铺</th>
                            <th>起拍价</th>
                            <th>最高出价</th>
                            <th>开拍时间</th>
                            <th>竞拍类型</th>
                        </tr>
                    </thead>
                    <tbody id="vip_explore">
                        <tr><td colspan="11" style="text-align:center;height:200px">浏览的车辆数据为空！</td></tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>
</div>
<script type="text/javascript" src="js/common/common_sup.js"></script>
<script type="text/javascript" src="plugins/layui/layui.js"></script>
<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script>
	var uri_vip_info = "/boss/user/getUserInfo";
	var uri_list_cycle = '/boss/userLog/getUserLog';
	var uri_vip_order ="/boss/order/getUserOrder";
	var vip_list_name_top =["statusName","depositAmount","id","userNum","userName","name",
	"mobile","cityName","tel1","tel2","levelName","groupName",
	"userStoreName","isShare","region","address"];/*top对象名*/
	var vip_list_pre_top ={
		"statusName":{"way":"normal","value":"会员状态：<b style=\"color:orange\">"},
		"depositAmount":{"way":"normal","value":"可用保证金：<b style=\"color:orange\">"}
		,"id":{"way":"normal","value":"会员编号："},
		"userNum":{"way":"normal","value":"车商号："}
		,"userName":{"way":"normal","value":"用户名："},
		"name":{"way":"normal","value":"真实姓名："},
	"mobile":{"way":"normal","value":"注册手机号："},
	"cityName":{"way":"normal","value":"身份城市："},
	"tel1":{"way":"normal","value":"备用电话1："},
	"tel2":{"way":"normal","value":"备用电话2："},
	"levelName":{"way":"normal","value":"会员级别："},
	"groupName":{"way":"normal","value":"会员组别："},
	"userStoreName":{"way":"normal","value":"所属店铺："},
	"isShare":{"way":"normal","value":"是否共享："} 
	,"region":{"way":"normal","value":"加价器编号："},
	"address":{"way":"normal","value":"通讯地址："}
	};
	var vip_list_aft_top ={
		"statusName":{"way":"normal","value":"</td>"},"depositAmount":{"way":"normal","value":"元</td>"},"id":null,"userNum":null,"userName":null,"name":null,
	"mobile":null,"cityName":null,"tel1":null,"tel2":null,"levelName":null,"groupName":null,
	"userStoreName":null,"isShare":null,"region":null,"address":null
	};
	
	$(function()
	{
		var id = getCookie("vip_details_id");
		init(id);
		init_cycle(id);
		init_order(id);
		init_follow(id);
		init_explore(id);
		init_pay(id);
	});
	function init(id)
	{
	
		
		var result_vip_info = sup_ajax(uri_vip_info,{"userId":id},false);
		if(result_vip_info==null||result_vip_info==""||result_vip_info.resultCode!=100){
			
			return ;
		}
		var vip_list_top = $("#vip_list_top");/*获取顶部表单对象*/
		/*开始创建相对应的Html页面  进行页面填充*/
		var html="";
		var prefix="";
		var aftfix="";
		for(var i=0;i<vip_list_name_top.length;i++){
			if(i<vip_list_name_top.length-4){
			if(i%2==0){
				html+='<tr>';
			}
			html+='<td>';
			html += modif(vip_list_pre_top,null,null,vip_list_name_top[i], "pre", null);
			if(eval('result_vip_info.data.'+vip_list_name_top[i])!=null){
				  ';'
			html+=eval('result_vip_info.data.'+vip_list_name_top[i]);
			 html+=modif(null,vip_list_aft_top,null,vip_list_name_top[i], "aft", null);
			}
			 
			html+='</td>';
			if(i%2!=0){
				html+='</tr>';
			}
				continue;
			}
			html+='<tr>';
			html+='<td colspan="2">';
				html += modif(vip_list_pre_top,null,null,vip_list_name_top[i], "pre", null);
			if(eval('result_vip_info.data.'+vip_list_name_top[i])!=null){
				if(vip_list_name_top[i]=='isShare'){
					var ttmp = eval('result_vip_info.data.'+vip_list_name_top[i]);
					if(ttmp==1){
						html+='共享';
					}
					else {
						html+='非共享';
					}
					continue;
				}
				html+=eval('result_vip_info.data.'+vip_list_name_top[i]);
			}
			 
			html+='</td>';
			html+='</tr>';
			
		} 
		vip_list_top.html(html);
		/*身份证 相关显示*/
		html="<tr><td>身份证号："+result_vip_info.data.identityNumber+"</td></tr>"; 
		html+="<tr><td>"; 
		var identityPhotoFront = result_vip_info.data.identityPhotoFront;
		var identityPhotoBack = result_vip_info.data.identityPhotoBack;
		var identityPhotoHand = result_vip_info.data.identityPhotoHand;
		if(identityPhotoFront==null){
			identityPhotoFront="images/u1627.png"
		}
		if(identityPhotoBack==null){
			identityPhotoBack="images/u1627.png"
		}
		if(identityPhotoHand==null){
			identityPhotoHand="images/u1627.png"
		}
		html+='<a target="_blank" href="'+identityPhotoFront+'"><img style="max-width:200px" src="'+identityPhotoFront+'" alt="身份证正面"/>&nbsp;&nbsp;';
		html+='<a target="_blank" href="'+identityPhotoBack+'"><img style="max-width:200px" src="'+identityPhotoBack+'" alt="身份证反面"/>&nbsp;&nbsp;';
		html+='<a target="_blank" href="'+identityPhotoHand+'"><img style="max-width:200px" src="'+identityPhotoHand+'" alt="手持身份证照片"/>&nbsp;&nbsp;';
		html+="</td></tr>";
		$("#idCard_tab").html(html);
		
	}
		/*tbody元素 list快速插入*/
	function simple_tab( tbody_id, pub_list, pub_map){
		
		var html="";
		
		for(var i=0;i<pub_list.length;i++){
			html+="<tr>";
			for(var j=0;j<pub_map.length;j++){
				html+="<td>";
				if(eval('pub_list[i].'+pub_map[j])!=null){
					htmp= eval('pub_list[i].'+pub_map[j]);
					if(pub_map[j]=='startingPrice'||pub_map[j]=='maxBidPrice'){
						htmp+="元";
					}
					else if(pub_map[j]=='auctionStartTime'||pub_map[j]=='createTime'){
						htmp=timeFormat(htmp);
					}
					else if(pub_map[j]=='auctionType'){
						
						switch(htmp)
						{
							case '1':
								htmp="线上";
								break;
							case '2':
								htmp="线下";
								break;
						}
					}
					html+=htmp;
				}
				
				html+="</td>";
			}
			html+="</tr>";
		}
		$("#"+tbody_id).html(html);
	}
	
	function init_cycle(id){//轨迹渲染
		console.log("开始轨迹渲染 用户id"+id);
		var result_list_cycle = sup_ajax(uri_list_cycle,{"userId":id},false); 
		if(result_list_cycle==null||result_list_cycle==""||result_list_cycle.resultCode!=100){
			
			return;
		}
		/*进行轨迹渲染*/
		
		var html='<legend>会员状态轨迹：</legend> <ul class="layui-field-box layui-timeline" style="margin:10px 0 0 20px">';
		
		for(var i=0;i<result_list_cycle.data.length;i++){
			html+='<li class="layui-timeline-item"> <i class="layui-icon layui-timeline-axis">&#xe63f;</i>';
			html+='<div class="layui-timeline-content layui-text">';
			html+=' <h3 class="layui-timeline-title">'+result_list_cycle.data[i].statusName+'</h3>';
			html+='<p>'+timeFormat(result_list_cycle.data[i].editTime)+'</p>';
			if(result_list_cycle.data[i].status==12||result_list_cycle.data[i].status==2||result_list_cycle.data[i].status==7
			||result_list_cycle.data[i].status==11){       
				html+=' <h3 class="layui-timeline-title">原因：'+result_list_cycle.data[i].msg+'</h3>'; 
				if(result_list_cycle.data[i].file!=null&&result_list_cycle.data[i].file!=""){
					html+='<h3 class="layui-timeline-title"><a target="_blank" href="'+result_list_cycle.data[i].file+'">点击下载附件</a></h3>';
				}
			}
			if(result_list_cycle.data[i].status==2){
				html+='<a target="_blank" href="'+result_list_cycle.data[i].customerAuth.identityPhotoFront+'"><img style="max-width:200px" src="'+result_list_cycle.data[i].customerAuth.identityPhotoFront+'" alt="身份证正面"/></a>&nbsp;&nbsp;';
				html+='<a target="_blank" href="'+result_list_cycle.data[i].customerAuth.identityPhotoBack+'"><img style="max-width:200px" src="'+result_list_cycle.data[i].customerAuth.identityPhotoBack+'" alt="身份证反面"/></a>&nbsp;&nbsp;';
				html+='<a target="_blank" href="'+result_list_cycle.data[i].customerAuth.identityPhotoHand+'"><img style="max-width:200px" src="'+result_list_cycle.data[i].customerAuth.identityPhotoHand+'" alt="手持身份证照片"/></a>&nbsp;&nbsp;';
			
			}
			if(result_list_cycle.data[i].status==5)
			{
				
				//html+=' <h3 class="layui-timeline-title">已缴纳保证金：'+result_list_cycle.data[i].customerDeposit.depositAmount+'</h3>'; 
			}
			html+='</div>';
		}
		
		
		html+=' </ul>';
		$("#vip_list_under").html(html);
		console.log("轨迹渲染结束");
	}
	function init_order(id){//初始化订单信息
		console.log("开始订单列表拉取");
		var html="";
		var vip_list_order = sup_ajax(uri_vip_order,{"userId":id,"page":1,"limit":10},false);
		if(vip_list_order==null||vip_list_order.resultCode!=100||vip_list_order.data.count==0){
			$("#vip_order_tab").html('<td colspan="11" style="text-align:center;height:200px">返回数据为空，没有订单信息！</td>');
			return;
		}
		var vip_order_map = ["orderNo","createTime","autoInfoName","carAutoNo","payFee",
		"auctionType","ifAgent","isBreach","initiatAuthMsg","status","remark"];
	var map_order_vip = {
		//"orderNo":{"way":"normal","value":""},
		"createTime":{"way":"const_st","value":"timestamp"},
		"autoInfoName":null,
		"carAutoNo":null,   
		"payFee":null,
		"auctionType":{"way":"replace","value":["线上","线下"]},
		"ifAgent":{"way":"replace","value":["需要","不需要"]},
		"isBreach":{"way":"replace","value":["违约","尚未违约"]},
		"initiatAuthMsg":null,
		"status":{"way":"replace","value":["等待付款","付款信息待审核","过户处理中","争议处理中","违约金支付确认中","手续回传待确认","交易完成","交易关闭"]},
		"remark":null
		};
		for(var j=0;j<vip_list_order.data.list.length;j++){
			html+="<tr>";
		for(var i=0;i<vip_order_map.length;i++){
			html+="<td>";
			if(eval('vip_list_order.data.list[j].'+vip_order_map[i])!=null){
				
			var temp_html =modif(null,null,map_order_vip,vip_order_map[i],"middle",eval('vip_list_order.data.list[j].'+vip_order_map[i]));
			if(vip_order_map[i]=='payFee'){
				temp_html+='元';
			}
			
			html+=temp_html;
			}
			html+="</td>";
		}
			html+="</tr>";
		}
		$("#vip_order_tab").html(html);
		console.log('订单列表拉取结束');
	}
	function init_pay(id){//获取支付订单
		console.log("开始拉取出价车辆 用户id"+id);
		var html="";

		var uri_vip_pay ="/boss/bid/getBidCarList";
		var vip_list_pay = sup_ajax(uri_vip_pay,{"userId":id,"page":1,"limit":10});
		
		var vip_pay_map =["carAutoNo","bidTime","autoInfoName","carStoreName",
		"startingPrice","entrustPrice","maxBidPrice",
		"auctionType","bidSuccess"];
		var map_vip_pay ={
			"carAutoNo":null,
			"bidTime":{"way":"const_st","value":"timestamp"},
			"autoInfoName":null,"carStoreName":null,
			"startingPrice":null,
			"entrustPrice":null,
			"maxBidPrice":null,
			"auctionType":{"way":"replace","value":["线上","线下"]},
			"bidSuccess":{"way":"replace","value":["成功","失败"]}
		};
		if(vip_list_pay==null||vip_list_pay==""||vip_list_pay.resultCode!=100){
			return;
		}
		for(var j=0;j<vip_list_pay.data.list.length;j++){
			html+="<tr>";
		for(var i=0;i<vip_pay_map.length;i++){
			html+="<td>";
			if(eval('vip_list_pay.data.list[j].'+vip_pay_map[i])!=null){
				var temp_html = eval('vip_list_pay.data.list[j].'+vip_pay_map[i]);
				if(vip_pay_map[i]=='startingPrice'||vip_pay_map[i]=='entrustPrice'||vip_pay_map[i]=='maxBidPrice'){
					temp_html+="元";
				}
				html+=modif(null,null,map_vip_pay,vip_pay_map[i],"middle",temp_html);
			}
			
			html+="</td>";
		}
			html+="</tr>";
		}
		$("#vip_pay").html(html);
		console.log("出价车辆拉取完成");
	}
	function init_follow(id){//关注的车
		console.log("开始拉取关注的车 用户id"+id);
		var uri_vip_follow = "/boss/follow/getUserFollow";
		var  vip_list_follow = sup_ajax(uri_vip_follow,{"userId":id,"page":1,"limit":10});
		if(vip_list_follow==null||vip_list_follow.resultCode!=100||vip_list_follow.data.count==0){
			$("#vip_explore").html('<td colspan="8" style="text-align:center;height:200px">没有关注的车辆！</td>');
			return;
		}
		vip_follow_map = ["createTime","carAutoNo","autoInfoName","carStoreName","startingPrice"
		,"maxBidPrice","auctionStartTime","auctionType"];
		simple_tab("vip_follow",vip_list_follow.data.list,vip_follow_map);
		console.log("渲染完毕");
	}
	function init_explore(id){
		console.log("开始拉取浏览列表 用户id"+id);
		var uri_vip_explore = "/boss/view/getViewCarList";
		var vip_list_explore = sup_ajax(uri_vip_explore,{"userId":id,"page":1,"limit":10});
		if(vip_list_explore==null||vip_list_explore.resultCode!=100||vip_list_explore.data.count==0){
			$("#vip_explore").html('<td colspan="8" style="text-align:center;height:200px">浏览的车辆数据为空！</td>');
			return;
		}
		vip_explore_map =["createTime","carAutoNo","autoInfoName","carStoreName","startingPrice"
		,"maxBidPrice","auctionStartTime","auctionType"];
		simple_tab("vip_explore",vip_list_explore.data.list,vip_explore_map);
		console.log("渲染完毕");
	}
layui.use('element', function(){
  var element = layui.element;
  
});   
</script>

</body>
</html>