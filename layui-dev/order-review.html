<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
	</head>

	<body class="layui-field-box layui-form">
		<div class="layui-field-box">
			<div class="layui-input-inline" style="width:220px">
				<input id="text1" placeholder="订单编号/姓名/电话号/车辆编号" class="layui-input" type="text">
			</div>
			<div class="layui-input-inline">
				<select class="layui-input" id="shop">
				</select>
			</div>
			<div class="layui-input-inline" style="width:300px;position:relative">
				<div class="layui-input-inline" style="width:100px">
					<select class="layui-input" id="carList">
						<option value="carAutoNo">车辆编号</option>
						<option value="autoInfoName">车辆标题</option>
						<option value="licenseNumber">车牌号</option>
						<option value="vin">VIN码</option>
					</select>
				</div>
				<input id="text2" style="position:absolute;width:200px;right:6px;top:0" placeholder="请输入" class="layui-input" type="text">
			</div>

			<div class="layui-btn" id="search"><i class="fa fa-search"></i>查询</div>
			<div class="layui-btn"><i class="fa fa-arrow-circle-o-up"></i>&nbsp;导出</div>
			<div class="layui-btn"><i class="layui-icon">&#xe608;</i>&nbsp;录入车辆</div>
		</div>
		<div class="layui-field-box">
			<table class="layui-table">
				<thead>
					<tr>
						<th style="width:300px">车辆信息</th>
						<th>订单编号</th>
						<th>买家信息</th>
						<th>价格信息</th>
						<th>竞拍信息</th>
						<th>争议信息</th>
						<th>争议类型</th>
						<th style="width:160px">申请争议原因</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody id="list">
					<tr>
						<td colspan="9" style="text-align:center;height:200px">暂无信息！</td>
					</tr>

				</tbody>
			</table>
		</div>
		<div id="content_div" class="layui-form" lay-filter="pop-form" style="padding:30px 40px 0 0 ;display:none">
			<div class="layui-form-item">
				<label class="layui-form-label">审核结果</label>
				<div class="layui-input-block">
					<input type="radio" value="2" class="layui-form-radio" name="opt" title="平退"/>
                    <div class="layui-form-item">
                    	<input type="radio" value="4" class="layui-form-radio" name="opt" title="买家违约(不需支付违约金)"/>
                    </div>
					<div class="layui-form-item">
						<input type="radio" value="3" class="layui-form-radio" name="opt" title="买家违约(需支付违约金)"/>
                        <div class="layui-input-inline" style="width:140px;float:right"><input placeholder="需支付违约金：元" type="text" class="layui-input" id="3" ></div>
					</div>
                    <div class="layui-form-item">				
						<input type="radio" value="5" class="layui-form-radio" name="opt" title="争议议价(修改待付车款)"/>
						<div class="layui-input-inline" style="width:140px;float:right"><input placeholder="需支付车款：元" type="text" class="layui-input" id="5" ></div>
					</div>
                    <div class="layui-form-item">
						<input type="radio" value="6" class="layui-form-radio" name="opt" title="卖家赔付"/>
                    	<div class="layui-input-inline" style="width:140px;float:none"><input placeholder="需支付赔付金：元" type="text " class="layui-input " id="6" ></div>
					</div>
				</div>

		 	</div>
		 	<div class="layui-form-item ">
		 			<label class="layui-form-label ">争议处理单:</label>
		 			<div class="layui-input-inline " style="width:200px ">
		 			<div class="layui-upload"><button type="text " class="layui-btn" id="upload"><i class="layui-icon">&#xe67c;</i>上传争议处理单</button></div> 
		 			</div>
		 	</div>
		 	<div class="layui-form-item ">
		 		<label class="layui-form-label ">审核意见:</label>
		 			<div class="layui-input-inline " style="width:200px ">
		 				<input type="text " class="layui-input " id="msg" >
		 			</div>
		 	</div>
		 </div>
	</body>
    
    <script type="text/javascript " src="plugins/layui/layui.all.js "></script>
	<script type="text/javascript " src="js/common/common_sup.js "></script>
	<script type="text/javascript " src="js/jquery-1.9.1.min.js "></script>
    <script>
    	var on_uri;   
    	layui.use('table', function() {
				
				upload = layui.upload,
					upload.render({
				elem: '#upload',
				url: base_url + '/boss/localeAuction/uploadImage',
				accept: 'file',
				before: function(obj) {
					layer.load();
				},
				done: function(res) {
					if(res.resultCode != 100) {
						alert("文件加载失败请重试 ");
						return;
					}
					on_uri = res.data.url;
					layer.msg("文件加载成功！ ");
					layer.closeAll('loading');
				},
				error: function(res) {
					
					layer.closeAll('loading');
				}
			});
			});
    	
    	var page=1;
    	var limit=10;
    	var uri_list = '/boss/order/selectBreachOrderList';
		var uri_shop ='/boss/carStore/selectAllStore';    
	$(function(){
		init();
		init_lab();
		$('#search').on('click',function(){
			 var shopId = $("#shop ").val()==0?null:$("#shop ").val();
			 var text1 = $("#text1 ").val().trim()==""?null: $("#text1 ").val().trim();
			 var text2 = $("#text2 ").val().trim();
			 var ops = $("#carList ").val();
			 var carAutoNo,licenseNumber,autoInfoName,vin;
			 if(text2!=""&&text2!=null){
			 	var cmd = ops+'='+text2+'';
				eval(cmd);			 
			 	}
			 
			 init(null,text1,shopId,carAutoNo,licenseNumber,autoInfoName,vin);
		})
	})
	function init(orderStatus,searchName,storeId,autoNo,licenseNumber,autoName,vin){
		var data_list={
			"orderStatus":orderStatus
			,"searchName":searchName
			,"storeId":storeId
			,"autoNo":autoNo
			,"licenseNumber":licenseNumber
			,"autoName":autoName
			,"vin":vin
			,"page":page
			,"limit":limit
		}
		var result_list = sup_ajax(uri_list,data_list,false);
		if(result_list==null||result_list==" "){
			return;
		}
		if(result_list.resultCode!=100){
			layer.msg(result_list.resultMsg);
			return;
		}
		var html=" ";
		for(var i=0;i<result_list.data.list.length;i++){
			html+='<tr>';
			html+='<td>';
			html+='<a class="car-list "><img src=" ' + result_list.data.list[i].mainPhoto + ' " alt="图片一 " height="78px " width="100px " style="float:left "/>';
			html+= '<span>' +
							result_list.data.list[i].autoInfoName +
							'<br/>车牌号：' +
							result_list.data.list[i].licenseNumber +
							'| ' + result_list.data.list[i].auctionNum +
							'次上拍<br/>' +
							result_list.data.list[i].cityName +
							"| " +
							new Date(result_list.data.list[i].registDate).getFullYear() +
							'年|' +
							result_list.data.list[i].mileage +
							'万千里<br/>VIN：' +
							result_list.data.list[i].vin +
							'</span></a>';
			html+='<a class="car-no ">车辆编号:' + result_list.data.list[i].carAutoNo + '</a>' + '<br>';
			html+='</td>';
			html+='<td><a class="car-no" target="_blank" href="order-detail.html?orderId='+result_list.data.list[i].id+'">'+result_list.data.list[i].orderNo+'</a></td>';
			html+='<td>';
			html+='姓名：'+result_list.data.list[i].userName+'<br>';
			html+='手机号：'+result_list.data.list[i].mobile+'<br>';
			html+='</td>';
			html+='<td>';
			html+='起拍价：'+result_list.data.list[i].startingPrice+'万<br>';
			html+='保留价：'+result_list.data.list[i].reservePrice+'万<br>';
			html+='</td>';
			
			html+='<td>';
			html+='最高出价:'+result_list.data.list[i].bidFee+'万元<br>';
			html+='竞拍类型:';
			html+=result_list.data.list[i].auctionType==null?" ":(result_list.data.list[i].auctionType==1?"线上 ":"线下 ");
			html+='<br>';
			html+='出价时间:'+timeFormat(result_list.data.list[i].bidTime);
			html+='</td>';
			html+='<td>';
			html+='发起人：';
			html+=result_list.data.list[i].initiatCn!=null?result_list.data.list[i].initiatCn:" ";
			html+='<br>';
			html+='发起时间：'+timeFormat(result_list.data.list[i].initiatTime)+'<br>';
			html+='</td>';
			html+='<td>';
			html+='争议类型：';
			html+=result_list.data.list[i].breachObjType==null?" ":(result_list.data.list[i].breachObjType==1?"买家违约 ":"卖家违约 ");
			html+='<br>';
			html+='</td>';
			html+='<td>';
			html+='争议信息：';
			html+=result_list.data.list[i].initiatMsg==null?" ":result_list.data.list[i].initiatMsg;
			html+='</td>';
			html+=' <td><a onclick="operation( '+result_list.data.list[i].id+","+result_list.data.list[i].breachId+') " href="javascript:; " class="layui-btn layui-btn-danger layui-btn-xs ">审核</a></td>';
			html+='</tr>';
		}
		$("#list ").html(html);
	}
	function init_lab(){//初始化列标签
		layui.use('form', function(){
	  		form = layui.form;
	  		var html = ' <option value="0 ">所属店铺</option>';
	  		var result  = sup_ajax(uri_shop,{},true);
	  		if(result!=null&&result.resultCode==100){
	  			for(var i=0;i<result.data.length;i++){
	  				html+='<option value=" '+result.data[i].id+' ">'+result.data[i].name+'</option>';
	  			}
	  			
	  		}
	  		$("#shop ").html(html);
	  		form.render();
	});
	
	}
	function operation(orderId,breachId){
		$("#3").val("");
		$("#5").val("");
		$("#6").val("");
		$("#msg").val("");
		on_uri=null;
		layer.open({
				  title: '争议审核',
				  type: 1,
				  content: $("#content_div"),
				  btn: ['确定', '取消'],
				  shade: false,
				  area: ['500px', '495px'],
				  success: function(){
					 
				  },
				  cancel:function(index)
				  { 
				  	$("#content_div ").hide();
					   	layer.close(index);
				  },
				  yes:function(index){
				  	var status = $("input[name='opt' ]:checked ").val();
				  	if(status==null){
				  		layer.msg("请选择一种状态");
				  		return;
				  	}
				  	var initialAuthFile = on_uri;
				  	var initiatAuthMsg = $("#msg").val();
				  	var amount=null;
				  	if(status==3||status==5||status==6)
					{
						amount=$("#"+status+'').val();
						if(amount==null||amount.trim()==""){
							layer.msg("必须填写金额");
				  		return;
						}
					}
					var data={
					"orderId":orderId
					,"breachId":breachId
					,"status":status
					,"initialAuthFile":initialAuthFile
					,"initiatAuthMsg":initiatAuthMsg
					,"amount":amount
		};
					var result_opt = sup_ajax('/boss/customerBreach/breachApprove',data,false);
					if(result_opt==null||result_opt==""){
						layer.msg("网络异常，请重试");
						return;
					}
					layer.msg(result_opt.resultMsg);
					if(result_opt.resultCode!=100){
						return;
					}
						init();
						$("#content_div ").hide();
					   	layer.close(index);   
					   	
				  },
				  btn2:function(index){
				  	$("#content_div ").hide();
					   	layer.close(index);
				  }
		});
		
			
	}
	</script>

</html>