<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>柠檬分享</title>
    <meta name="viewport" content="width=750px, user-scalable=no"/>
    <link rel="stylesheet" href="../css/lemon.css">
</head>
<body bgcolor="#f9f9f9">
<div style="margin: 0 auto;height: 0;padding: 0;overflow: hidden">
    <img src="" alt="" id="shareImg">
</div>
<div class="lemon saleShare">
    <div class="top">
        <div class="t-top download">
            <img class="l" src="../images/share/logo.png" alt=""><span class="l">柠檬竞价</span><span class="r"> 下载APP</span>
        </div>
        <div class="top-txt">
            <span class="saleTit l">北京西红门通道</span>
            <span class="carNum r">竞拍：230辆</span>
        </div>
    </div>
    <ul class="cen"></ul>
    <div class="fix">
        <a href="javascript:void(0)" class="toCall">预约看车</a>
    </div>
    <div class="carContact">
        <div class="calBox">
            <img src="image/close.png" class="closeBtn">
            <p>留下号码方便联系您看车</p>
            <input type="number" id="callNum" placeholder="请输入手机号 ...">
            <div class="callBtn">确定预约</div>
            <a href="tel:18513042868" id="tell">如需加急，请 <font class="color">电话预约</font></a>
        </div>
    </div>
    <div class="msg"></div>
    <div class="load">
        <img src="image/load_top.png" alt="在微信中打开" class="loadTop r">
        <img src="image/load_btm.png" class="loadBtm">
    </div>
</div>
</body>
<script src="http://static.yuntongauto.com/js/jquery.min.js"></script>
<script src="js/share.js"></script>
<script>
    $('.closeBtn').click(function () {
        $(this).parents('.carContact').hide()
    })
    $('.toCall').click(function () {
        $('.carContact').show()
    })
    $('.callBtn').click(function () {
        var callNum=$('#callNum').val().trim();
        if(callNum){
            if(/^1[3,4,5,6,7,8,9]\d{9}$/.test(callNum)){
                if(getUrlParam().auctionId){
                    saveSeeCal(callNum,getUrlParam().auctionId)
                }else{
                    $('.msg').html('场次id为空，请联系管理员。').fadeIn().delay(500).fadeOut()
                }
            }else{
                $('.msg').html('请核对您的电话').fadeIn().delay(500).fadeOut()
            }
        }else{
            $('.msg').html('电话号码不能为空').fadeIn().delay(500).fadeOut()
        }
    })


    function saveSeeCal(contactPhone,reservationId) {
        $.ajax({
            url:basePath+'/boss/reservationSeeCar/saveReservationSeeCar',
            type:'post',
            dataType:'json',
            data:JSON.stringify({
                contactPhone:contactPhone,
                reservationId:reservationId
            }),
            beforeSend: beforeSend,
            error : function(data) {
                $('.msg').html('服务器走丢了，请联系管理员').fadeIn(500).delay(2500).fadeOut(500)
            },
            success : function(data){
                if(data.success){
                   $('.carContact').hide();
                }else{
                    $('.msg').html(data.resultMsg).fadeIn(500).delay(2500).fadeOut(500)
                }
            }
        });
    }
    refresh()
var page=1,limit=3;
    function init() {
      getBaseMsg(getUrlParam().auctionId,page,limit)
    }
  init();
    function getBaseMsg(auctionId,page,limit) {
        $.ajax({
            url:basePath+'/boss/localeAuction/selectAuctionCarList',
            type:'post',
            dataType:'json',
            data:JSON.stringify({
                auctionId:auctionId,
                page:page,
                limit:limit
            }),
            beforeSend:beforeSend,
            error : function(data) {
                $('.msg').html('服务器走丢了，请联系管理员').fadeIn(500).delay(2500).fadeOut(500)
            },
            success : function(data){
                console.log(data)
                if(data.success){
                    BaseMsgView(data.data)
                }else{
                    $('.msg').html(data.resultMsg).fadeIn(500).delay(2500).fadeOut(500)
                }
            }
        });
    }
    function BaseMsgView(data) {
        $('.saleTit').html(data.title)
        $('#tell').attr('href','tel:'+data.desc)
        $('.carNum').html('竞拍：'+data.count+'辆')
        if(data.dataList.length<1){
            $('.msg').html('没有更多数据').fadeIn(500).delay(2000).fadeOut(500)
        }else{
           $.each(data.dataList,function (i, v) {
               var city=''
               if(v.vehicleAttributionCity){
                   city='['+(v.vehicleAttributionCity).slice(0,-1)+']';
               }
               var mainPhoto='http://static.yuntongauto.com/web/lay-ui/images/car-index.png'
               if(v.mainPhoto){
                   mainPhoto=v.mainPhoto;
               }
               var environment=''
               if(v.environment){
                   environment= '<font>'+v.environment+'</font>';
               }
               var mileage=''
               if(v.mileage){
                   mileage='<font>'+v.mileage+'里程</font>\n' ;
               }
               $('.cen').append(' <li>\n' +
                       '            <div class="listTop">\n' +
                       '                <div class="l imgBox">\n' +
                       '                    <em>'+v.auctionCode+'</em>\n' +
                       '                    <img src="'+mainPhoto+'" alt="">\n' +
                       '                </div>\n' +
                       '                <div class="l carBox">\n' +
                       '                    <p class="carTit">'+city+v.autoInfoName+'</p>\n' +
                       '                    <p class="carStr">\n' +
                       '                        <font>'+timeFormat(v.beginRegisterDate).y+'年'+timeFormat(v.beginRegisterDate).m+'月'+timeFormat(v.beginRegisterDate).d+'日</font>' +
                       environment+
                       mileage+
                       '                    </p>\n' +
                       '                </div>\n' +
                       '            </div>\n' +
                       '            <div class="listBtm">\n' +
                       '                <span>起拍价：</span><span class="startPrice"><span class="num_">'+v.startingPrice/10000+'万</span>起</span>\n' +
                       '            </div>\n' +
                       '        </li>')
           })
        }
    }
    function refresh() {
        $(window).scroll(function(){
            var scrollTop = $(this).scrollTop();    //滚动条距离顶部的高度
            var scrollHeight = $(document).height();   //当前页面的总高度
            var clientHeight = $(this).height();    //当前可视的页面高度
            //console.log("top:"+scrollTop+",doc:"+scrollHeight+",client:"+clientHeight);
            if(scrollTop + clientHeight >= scrollHeight-2){   //距离顶部+当前高度 >=文档总高度 即代表滑动到底部 count++;
                page++;
                getBaseMsg(getUrlParam().auctionId,page,limit)
            }
        });
    }

</script>
</html>