<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
	</head>

	<body>

		<div class="layui-field-box">
			<div class="layui-tab">
				<ul class="layui-tab-title">
					<li class="layui-this" style="margin-left:24px">首页轮播设置</li>
					<li>播报设置</li>
					<li>关于我们</li>
					<li>常见问题</li>
				</ul>
				<div class="layui-tab-content" style="height:560px">
					<div class="layui-tab-item layui-show">
						<table class="layui-table">
							<thead>
								<tr>
									<th style="width:120px">图片</th>
									<th>图片尺寸</th>
									<th>跳转类型</th>
									<th>跳转路径</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="main_tab">

							</tbody>
						</table>
					</div>

					<div class="layui-tab-item">
						<table class="layui-table">
							<thead>
								<tr>
									<th>播报标题</th>
									<th>跳转路径</th>
									<th>跳转类型</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="list_tab">

							</tbody>
						</table>
					</div>

					<div class="layui-tab-item" style="width:500px;margin-top:20px" id="about">
						<div class="layui-form-item">
							<label class="layui-form-label" style="padding-left:0px">联系客服</label>
							<div class="layui-input-block"><input id="sale_phone" type="text" class="layui-input" placeholder="请输入客服电话" value="010-67523489" disabled /></div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label" style="padding-left:0px">关于我们</label>
							<div class="layui-input-block"><textarea id="sale_about" class="layui-textarea" placeholder="可输入关于柠檬好车的介绍" disabled>柠檬二手车，专业检测师，优质车源</textarea></div>
						</div>
						<div class="layui-input-block">
							<button class="layui-btn" id="sale_remix">修改</button><button class="layui-btn layui-btn-primary" id="sale_reset">取消</button>
						</div>
					</div>

					<div class="layui-tab-item">
						<div class="layui-field-box">
							<div class="layui-input-inline" style="width:220px"><input id="qst_text" placeholder="输入问题搜索" class="layui-input" type="text"></div>
							<div class="layui-btn" id="tb_search"><i class="fa fa-search"></i>查询</div>
							<div class="layui-btn"><i class="layui-icon">&#xe608;</i>&nbsp;新增问题</div>
						</div>
						<div class="layui-field-box" style="padding-top:0">
							<table class="layui-table">
								<thead>
									<tr>
										<th>序号</th>
										<th>标题</th>
										<th>内容</th>
										<th>描述</th>
										<th width="84">是否首页显示</th>
										<th width="78">操作</th>
									</tr>
								</thead>
								<tbody id="qst_list">

								</tbody>
							</table>
						</div>
					</div>

				</div>
			</div>
		</div>

		<!--轮播设置-->
		<div id="slider_box" class="layui-field-box layui-form" style="padding:20px 0 0 20px;display:none">
			<div class="layui-form-item"><span class="layui-form-label">跳转类型：</span><span class="layui-input-inline"><select class="layui-input" id="app_select"><option value="1">拍卖场次</option><option value="2">竞拍车辆</option><option value="6">网页地址</option><option value="7">图文</option></select></span></div>
			<div class="layui-form-item"><span class="layui-form-label">跳转路径：</span><span class="layui-input-inline"><input  id="app_itext"  class="layui-input" placeholder="网址/场次编号/车辆编号" type="text"></span></div>
			<div class="layui-form-item layui-upload" style="text-align:center;padding-bottom:0px;padding-top:15px">
				<div class="layui-upload-drag" id="upload"><i class="layui-icon">&#xe67c;</i>
					<p>点击上传轮播图，或将文件拖拽到此处</p>
				</div>
			</div>
		</div>

		<!--播报设置-->
		<div id="broadcast_box" class="layui-field-box layui-form" style="padding:20px 0 0 20px;display:none">
			<div class="layui-form-item"><span class="layui-form-label">播报标题：</span><span class="layui-input-inline"><input id="title_app" class="layui-input" placeholder="请输入播报标题" type="text"></span></div>
			<div class="layui-form-item"><span class="layui-form-label">跳转类型：</span><span class="layui-input-inline"><select id="web_app" class="layui-input"><option value="1">拍卖场次</option><option value="2">竞拍车辆</option><option value="6">网页地址</option><option value="7">图文</option></select></span></div>
			<div class="layui-form-item"><span class="layui-form-label">跳转路径：</span><span class="layui-input-inline"><input  id ="ip_app" class="layui-input" placeholder="网址/场次编号/车辆编号" type="text"/></span></div>
		</div>

	</body>

	<script type="text/javascript" src="plugins/layui/layui.all.js"></script>
	<script type="text/javascript" src="js/common/common_sup.js"></script>
	<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
	<script>
		var flag = false;
		$(function() {
			init_tab(2);
			init_tab(1);
			init_about();
			init_qus();
		})
		/*初始化函数*/
		function init_tab(type) {
			var data_main_tab = {
				"type": type
			};
			var html_main_tab = "";
			var tb_main_tab = $("#main_tab");
			var uri_main_tab = "/boss/appSlideshow/selectAppSlideshowList";
			var map_main_tab = ["img", "size", "openType", "openObj"];
			if(type == 1) {
				tb_main_tab = $("#list_tab");
				map_main_tab = ["title", "openObj", "openType"];
			}
			var result_main_tab = sup_ajax(uri_main_tab, data_main_tab, false);
			if(result_main_tab == null || result_main_tab == "" || result_main_tab.resultCode != 100 || result_main_tab.data.length == 0) {
				tb_main_tab.html('<td colspan="10" style="text-align:center;height:200px">没有数据！</td>');
				return;
			}
			for(var i = 0; i < result_main_tab.data.length; i++) {
				html_main_tab += '<tr>';
				for(var j = 0; j < map_main_tab.length; j++) {
					var cmd_main_tab = 'result_main_tab.data[i].' + map_main_tab[j];
					
						
							switch(map_main_tab[j]) {
								case 'size':
									html_main_tab += '<td>750*350</td>'
									continue;
									break;
								case 'img':
									html_main_tab += '<td><img src="' + eval(cmd_main_tab) + '"/></td>';
									continue;
									break;
								case 'openType':
									if(eval(cmd_main_tab) == 1) {
										html_main_tab += '<td>拍卖场次</td>';
									} else if(eval(cmd_main_tab) == 2) {
										html_main_tab += '<td>竞拍车辆</td>';
									} else if(eval(cmd_main_tab) == 6) {
										html_main_tab += '<td>网页地址</td>';
									} else {
										html_main_tab += '<td>图文</td>';
									}
									continue;
									break;
								default:
									html_main_tab += '<td><a href="' + eval(cmd_main_tab) + '">'+eval(cmd_main_tab)+'</a></td>';
									continue;

							}
						
					
					
					html_main_tab += '<td>';
					if(eval(cmd_main_tab) != null)
						html_main_tab += '' + eval(cmd_main_tab);
					html_main_tab += '</td>';

				}

				tmp_ht = '<td onclick="up_tab(' + result_main_tab.data[i].id + ',' +
					result_main_tab.data[i].openType + ',\'' +
					result_main_tab.data[i].openObj + '\',' +
					result_main_tab.data[i].sort + ',' +
					result_main_tab.data[i].ifShow +',' +
					type+
					')"><a href="javascript:;" class="layui-btn layui-btn-sm broadcast">修改</a></td>';

				html_main_tab += tmp_ht;
				html_main_tab += '</tr>';
			}
			tb_main_tab.html(html_main_tab);

		}

		function up_tab(id, openType, openObj, sort, ifShow,type) {
			
			
			layui.use('table', function() {

				var table = layui.table,
					upload = layui.upload,
					form = layui.form,
					$ = layui.jquery;
				var on_uri;
				var uri_up_up = "/boss/appSlideshow/updateAppSlideshow";
				switch(type){
				case 2:
				var uploadInst = upload.render({
					elem: '#upload',
					url: base_url+'/boss/localeAuction/uploadImage',

					before: function(obj) {
						layer.load();
					},
					done: function(res) {
						if(res.resultCode != 100) {
							alert("图片上传失败请重试");

							return;
						}
						on_uri = res.data.url;
						layer.closeAll('loading');
					},
					error: function(res) {
						
						layer.closeAll('loading');
					}
				});
				
				layer.open({
					title: '轮播设置',
					type: 1,
					btn: ['确定', '取消'],
					shade: 0,
					area: ['380px', '395px'],
					content: $("#slider_box"),
					success: function() {

						form.render(null, 'pop-form');

					},
					yes: function(index) {
						/*确认操作*/
						var app_sele = $("#app_select").val(); /*app参数*/
						var app_text = $("#app_itext").val().trim();
						if(app_text == "" || app_text == null) {
							layer.msg("请在文本框输入相关信息");
							return;
						}
						if(on_uri == null) {
							layer.msg("请完成上传图片操作再继续");
							return;
						}
						var data_up = {
							"id": id,
							"openType": app_sele,
							"openObj": app_text,
							"sort": sort,
							"ifShow": ifShow,
							"img": on_uri

						};
						
						var result = sup_ajax(uri_up_up, data_up, false);
						if(result.resultCode == 100) {
							$("#slider_box").hide();
							init_tab(2);
							layer.close(index);
							
							
						} else {
							layer.msg("修改失败");
						}
					},
					cancel:function(index)
					{
						layer.close(index);
						$("#slider_box").hide();
					},
					btn2:function(index){
						layer.close(index);
						$("#slider_box").hide();
					}
				});
					break;
				case 1:
					layer.open({
							title: '播报设置',
							type: 1,
							btn: ['确定', '取消'],
							shade: 0,
							area: ['380px', '280px'], 
							content: $("#broadcast_box"),
							success: function() {

						form.render(null, 'pop-form');

					},
					yes: function(index) {
						/*确认操作*/
						var title_app = $("#title_app").val().trim(); /*app参数*/
						var web_app = $("#web_app").val();  
						var ip_app = $("#ip_app").val().trim();
						if( title_app== "" || title_app == null||ip_app==""||ip_app==null) { 
							layer.msg("请在文本框填写相关信息");
							return;
						}
						
						var data_up = {
							"id": id,
							"openType": web_app,
							"openObj": ip_app,
							"sort": sort,
							"ifShow": ifShow,
							"img": on_uri,
							"title":title_app

						};
						
						var result = sup_ajax(uri_up_up, data_up, false);
						if(result.resultCode == 100) {
							$("#broadcast_box").hide();
							init_tab(1);
							layer.close(index);
							
							
						} else {
							layer.msg("修改失败");
						}
					},
					cancel:function(index)
					{
						layer.close(index);
						$("#broadcast_box").hide();
					},
					btn2:function(index){
						layer.close(index);
						$("#broadcast_box").hide();
					}
						});
					break;
				}//switch
				
			});
			
			
		}
		
		function init_about() {
			$('#sale_reset').hide();
			var uri_about_remix = "/boss/appInfo/updateAboutUs";
			var uri_about = "/boss/appInfo/selectAboutUs";
			var result_about = sup_ajax(uri_about, {}, true);
			if(result_about == null || result_about == "" || result_about.resultCode != 100) {
				$("#about").hide();
				return;
			}
			var text_about = result_about.data.about;
			var text_phone = result_about.data.tel;
			$("#sale_phone").val(text_phone);
			$("#sale_about").val(text_about);
			$('#sale_remix').on('click', function() {
				$('#sale_reset').show();
				if(!flag) {

					$("#sale_phone").removeAttr("disabled");
					$("#sale_about").removeAttr("disabled");
					$('#sale_remix').text("提交");
					flag = true;
				} else {
					var data_about = {
						"about": $("#sale_about").val(),
						"tel": $("#sale_phone").val()
					};
					var result_about_remix = sup_ajax(uri_about_remix, data_about, false);
					if(result_about_remix == null || result_about_remix == "" || result_about_remix.resultCode != 100) {
						layer.msg("提交失败 请重试");
					} else {

						$('#sale_remix').text("修改");
						$("#sale_phone").attr("disabled", "disabled");
						$("#sale_about").attr("disabled", "disabled");
						$('#sale_reset').hide();
						flag = false;
						layer.msg("修改成功");
					}

				}
			});
			$('#sale_reset').on('click', function() {

				$("#sale_phone").attr("disabled", "disabled");
				$("#sale_phone").val(text_phone);
				$("#sale_about").attr("disabled", "disabled");
				$("#sale_about").val(text_about);
				$('#sale_remix').text("修改");
				flag = false;

			});
		}
		/*常见问题初始化*/
		function init_qus(questionName, classifyId) {
			var tb_qst_list = $("#qst_list");
			var uri_qst = "/boss/question/selectQuestionList";
			var map_qst = ["id", "title", "content", "description", "showIndex"];
			var data_qst = {
				"questionName": questionName,
				"classifyId": classifyId
			};
			var result_qst = sup_ajax(uri_qst, data_qst, false);

			if(result_qst == null || result_qst == "" || result_qst.resultCode != 100 || result_qst.data.length == 0) {
				tb_qst_list.html('<td colspan="10" style="text-align:center;height:200px">没有数据！</td>');
				return;
			}
			var html = "";
			for(var i = 0; i < result_qst.data.list.length; i++) {
				html += '<tr>';
				for(var j = 0; j < map_qst.length; j++) {
					html += '<td>';
					if(eval('result_qst.data.list[i].' + map_qst[j])!=null)
					html += eval('result_qst.data.list[i].' + map_qst[j]);
					html += '</td>';
				}
				html += '<td><a href="javascript:;" class="layui-btn layui-btn-xs">修改</a><a onclick="delt('+result_qst.data.list[i].id+')" href="javascript:;" class="layui-btn layui-btn-danger layui-btn-xs">删除</a></td>';
				html += '</tr>';
			}
			tb_qst_list.html(html);
			/*绑定修改事件*/
			$("#tb_search").on('click',function(){
				var text_search =   $("#qst_text").val().trim();
				init_qus(text_search);
			});
		}
		function delt(id)
		{
			var uri_del = "/boss/question/updateQuestion";
			var data_del ={
				  id:id
			} ;
			var result_del = sup_ajax(uri_del,data_del);
			if(result_del==null||result_del==""||result_del.resultCode!=100){
				layer.msg("网络阻塞，请重试");
				return;
			}
			
			layer.msg("删除成功");
			init_qus();
		}
		function upd(classifyName,id,isOpen,sort)
		{
			
		}
	</script>
	<script>
		
	</script>

</html>