<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>列表</title>
    <meta name="viewport" content="width=750px">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="http://test.yuntongauto.com/wintop-mall/css/list.css">
</head>
<body bgcolor="#f5f5f5">
<!--<div class="backBox">
    &lt;!&ndash;个人中心&ndash;&gt;
    <a href="javascript:window.history.go(-1)" class="l">
        <img src="http://test.yuntongauto.com/wintop-mall/img/back.png" alt="">
    </a>
    <a href="index.html?id=1&userid=09" class="r">
        <img src="http://test.yuntongauto.com/wintop-mall/img/index.png" alt="">
    </a>
</div>-->
<div class="myTop myTop1">
    <a href="javascript:window.history.go(-1)" class="lBox back">
        <img src="http://test.yuntongauto.com/wintop-mall/img/back.png" alt="">
    </a>
    商品订单
    <a href="index.html?id=1&userid=09" class="toIndex rBox">
        <img src="http://test.yuntongauto.com/wintop-mall/img/index.png" alt="">
    </a>
</div>
<div class="listBox">
    <div class="item">
        <a href="orderDetail.html">
            <p class="tit">会员套餐</p>
            <div class="cont">
                <img src="http://static.yuntongauto.com/web/badminton/img/branch-10.png" class="l">
                <p class="l tName">重庆汇捷专属套餐</p>
            </div>
        </a>
        <div class="btnBox">
            <p class="l">
                实际付款<span class="price">¥2999</span>
            </p>
            <a href="javascript:void(0)" class="r">会员卡号：667668</a>
        </div>
        <img src="img/pay.png" class="bgIcon">
    </div>
    <div class="item">
        <a href="orderDetail.html">
            <p class="tit">会员套餐</p>
            <div class="cont">
                <img src="http://static.yuntongauto.com/web/badminton/img/branch-10.png" class="l">
                <p class="l tName">重庆汇捷专属套餐</p>
            </div>
        </a>
        <div class="btnBox">
            <p class="l btnp">
                实际付款<span class="price">¥2999</span>
            </p>
            <a href="pay.html?orderid=123" class="r btn"><span>立即支付</span></a>
        </div>
        <img src="img/nopay.png" class="bgIcon">
    </div>
</div>
<div class="nodata">
    <img src="http://test.yuntongauto.com/wintop-mall/img/nodata.png" alt="">
    没有更多商品了～
</div>
</body>
<script src="http://static.yuntongauto.com/js/jquery.min.js"></script>
<script src="js/common.js"></script>
<script>
let list={
    m:{
        query:function () {
            base.GTsetAjax('get','mallorderapi/querymallorderlist',{pageSize:list.c.pageSize,pageNum:list.c.pageNum},function (data) {
                list.v.listView(data)
            })
        }
    },
    v:{
        listView:function (data) {
console.log(data)
            list.c.count=data.count;
            if(list.c.count>$('.item').length){
                $.each(data.list,function (i,v) {


                    let stutas=v.status;

                    let goodsTitle='';
                    if(!$('.item').length){
                        $('.listBox').html('')
                    }
                    if(v.mallOrderGoods){
                        goodsTitle=v.mallOrderGoods.goodsTitle;
                    }
                    //商品最终类型1:虚拟商品2:到店安装3:邮寄商品
                    //类型：Number  必有字段  备注：订单状态：1待支付、2已支付、3取消 4已完成
                    let url='img/nopay.png';
                    let str='<a href="pay.html?orderid='+v.id+'" class="r btn"><span>立即支付</span></a>';

                    switch (stutas){
                        case 1:
                            url='img/nopay.png';
                            str='<a href="pay.html?orderid='+v.id+'" class="r btn"><span>立即支付</span></a>'
                            break
                        case 2:
                            switch (Number(v.goodsType)){
                                case 1:
                                    str='<a href="toCard.html?orderid='+v.id+'" class="r btn"><span>充入会员</span></a>'
                                    break
                                case 2:
                                    str=''
                                    break
                                case 3:
                                    str='<a href="getAdr.html?orderid='+v.id+'" class="r btn"><span>填写收货地址</span></a>';
                                    break;
                            }
                            url='img/pay.png'
                            break
                        case 3:
                            str='';
                            break;
                        case 4:
                            switch (Number(v.goodsType)){
                                case 1:
                                    str='<a href="javascript:void(0)" class="r">会员卡号：667668</a>'
                                    break
                                case 2:
                                    str=''
                                    break
                                case 3:
                                    str='';
                                    break;
                            }
                            url='img/pay.png'
                            break;
                    }
                    //跳转支付

                    $('.listBox').append('<div class="item">\n' +
                            '        <a href="orderDetail.html?orderid='+v.id+'">\n' +
                            '            <p class="tit">会员套餐</p>\n' +
                            '            <div class="cont">\n' +
                            '                <img src="'+v.mallGoodsInfo.mainImg+'" class="l">\n' +
                            '                <p class="l tName">'+goodsTitle+'</p>\n' +
                            '            </div>\n' +
                            '        </a>\n' +
                            '        <div class="btnBox">\n' +
                            '            <p class="l">\n' +
                            '                实际付款<span class="price">¥'+v.payFee+'</span>\n' +
                            '            </p>\n' +str+
                            //'            <a href="javascript:void(0)" class="r">会员卡号：667668</a>\n'+
                            '        </div>\n' +
                            '        <img src="'+url+'" class="bgIcon">\n' +
                            '    </div>')
                })
            }
        },
        scrollFn:function () {
            //真实内容的高度
            let pageHeight = Math.max(document.body.scrollHeight, document.body.offsetHeight);
            //视窗的高度
            let viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight || 0;
            //隐藏的高度
            let scrollHeight = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
            let l=$('.item').length;
            if(list.c.count > l){
                if (pageHeight - viewportHeight - scrollHeight < 10) {    //如果满足触发条件，执行
                    list.c.pageNum++;
                    list.m.query();
                    console.log(list.c.pageNum)
                }
            }else if(list.c.count == l){
                if(list.c.flag){
                    list.c.flag=false
                    list.m.query();
                }
            }
        }
    },
    c:{
        pageSize:10,
        pageNum:0,
        count:1,
        flag:true,
        init:function () {
            list.m.query()
            $(window).bind("scroll", list.v.scrollFn);
        }
    }
}
//list.c.init();
</script>
</html>